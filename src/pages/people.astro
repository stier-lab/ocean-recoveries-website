---
import Layout from '@layouts/Layout.astro';
import PersonCard from '@components/people/PersonCard.astro';
import { currentTeam, alumni } from '@data/team';

// Sort team by order
const sortedTeam = [...currentTeam].sort((a, b) => a.order - b.order);

// Role labels for display
const roleLabels: Record<string, string> = {
  pi: 'Principal Investigator',
  postdoc: 'Postdoctoral Researchers',
  phd: 'PhD Students',
  manager: 'Lab Staff',
  undergrad: 'Undergraduate Researchers',
};

// Get unique roles in order
const roles = ['pi', 'postdoc', 'phd', 'manager', 'undergrad'].filter(
  role => sortedTeam.some(member => member.role === role)
);
---

<Layout
  title="People"
  description="Meet the Ocean Recoveries Lab team - researchers studying coral reef and kelp forest recovery at UC Santa Barbara."
>
  <!-- Hero -->
  <section class="relative py-20 md:py-28 overflow-hidden">
    <div
      class="absolute inset-0 bg-cover bg-center"
      style="background-image: url('/images/research-team-group-photo-beach.jpeg');"
    >
      <div class="absolute inset-0 bg-navy-deep/70"></div>
    </div>

    <div class="relative container text-center text-white">
      <h1 class="text-white mb-4">Our Team</h1>
      <p class="text-xl text-white/80 max-w-2xl mx-auto">
        We study the recovery and resilience of ocean ecosystems using field experiments,
        modeling, and synthesis â€” and we try to have fun doing it.
      </p>
    </div>
  </section>

  <!-- Current Members - Single Grid -->
  <section class="section bg-surface">
    <div class="container">
      <div class="text-center mb-8 scroll-reveal">
        <span class="eyebrow">Current Members</span>
        <h2>Meet the Lab</h2>
      </div>

      <!-- Role filters -->
      <div class="flex flex-wrap justify-center gap-2 mb-10 scroll-reveal">
        <button class="chip active" data-role="all">All Team</button>
        {roles.map(role => (
          <button class="chip" data-role={role}>
            {roleLabels[role]}
          </button>
        ))}
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" id="team-grid">
        {sortedTeam.map((member, i) => (
          <div class={`team-member scroll-reveal stagger-${(i % 3) + 1}`} data-role={member.role}>
            <PersonCard {...member} />
          </div>
        ))}
      </div>

      <!-- Empty state -->
      <div id="no-members" class="hidden text-center py-12">
        <p class="text-muted text-lg">No team members found with that role.</p>
        <button class="btn btn-secondary mt-4" id="clear-role-filter">Show All</button>
      </div>
    </div>
  </section>

  <!-- Alumni -->
  <section class="section bg-navy-highlight">
    <div class="container">
      <div class="text-center mb-12 scroll-reveal">
        <span class="eyebrow">Lab Alumni</span>
        <h2>Where Are They Now?</h2>
      </div>

      <div class="alumni-grid">
        {alumni.map((alum, i) => (
          <div class={`alumni-card scroll-reveal stagger-${(i % 6) + 1}`}>
            {alum.image ? (
              <img src={alum.image} alt={alum.name} class="alumni-photo" loading="lazy" />
            ) : (
              <div class="alumni-avatar">
                <span class="alumni-initial">{alum.name.charAt(0)}</span>
              </div>
            )}
            <div class="alumni-info">
              <div class="alumni-header">
                <span class="alumni-name">{alum.name}</span>
                {alum.linkedin && (
                  <a
                    href={alum.linkedin}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="linkedin-link"
                    aria-label={`${alum.name}'s LinkedIn`}
                  >
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                  </a>
                )}
              </div>
              <span class="alumni-role-years">{alum.role} &bull; {alum.years}</span>
              {alum.focus && <span class="alumni-focus">{alum.focus}</span>}
              {alum.currentPosition && (
                <span class="alumni-current">Now: {alum.currentPosition}</span>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Join CTA -->
  <section class="section bg-navy-deep">
    <div class="container text-center">
      <h2 class="text-white mb-4 scroll-reveal">Interested in Joining?</h2>
      <p class="text-white/70 max-w-xl mx-auto mb-8 scroll-reveal">
        We're always looking for motivated researchers passionate about ocean conservation
        and ecosystem recovery.
      </p>
      <a href="/join-us" class="btn btn-primary scroll-reveal">
        View Opportunities
      </a>
    </div>
  </section>
</Layout>

<style>
  /* Role filter chip styles */
  .chip {
    @apply px-4 py-2 rounded-full text-sm font-medium;
    @apply bg-surface-card border border-line text-muted;
    @apply transition-all duration-200 cursor-pointer;
  }

  .chip:hover {
    @apply border-accent text-accent;
  }

  .chip.active {
    @apply bg-accent text-white border-accent;
  }

  .team-member.hidden {
    @apply !hidden;
  }

  /* Alumni styles */
  .alumni-grid {
    @apply grid sm:grid-cols-2 lg:grid-cols-3 gap-4;
  }

  .alumni-card {
    @apply flex gap-4 p-4 rounded-xl;
    @apply bg-surface-card border border-line;
    @apply transition-all duration-300;
  }

  .alumni-card:hover {
    @apply -translate-y-1 shadow-lg border-accent/30;
  }

  .alumni-photo {
    @apply w-12 h-12 rounded-full flex-shrink-0 object-cover;
  }

  .alumni-avatar {
    @apply w-12 h-12 rounded-full flex-shrink-0;
    @apply bg-accent/20;
    @apply flex items-center justify-center;
  }

  .alumni-initial {
    @apply text-lg font-bold text-accent;
  }

  .alumni-info {
    @apply flex flex-col gap-1 min-w-0;
  }

  .alumni-header {
    @apply flex items-center gap-2;
  }

  .alumni-name {
    @apply font-bold text-ink truncate;
  }

  .linkedin-link {
    @apply text-muted hover:text-accent;
    @apply transition-colors flex-shrink-0;
  }

  .alumni-role-years {
    @apply text-xs font-semibold text-accent;
  }

  .alumni-focus {
    @apply text-sm text-muted line-clamp-2;
  }

  .alumni-current {
    @apply text-xs text-muted-2 italic;
  }
</style>

<script>
  const initRoleFilters = () => {
    const chips = document.querySelectorAll('.chip[data-role]');
    const members = document.querySelectorAll('.team-member');
    const noMembers = document.getElementById('no-members');
    const clearBtn = document.getElementById('clear-role-filter');

    const filterByRole = (role: string) => {
      let visibleCount = 0;

      members.forEach((member) => {
        const memberRole = (member as HTMLElement).dataset.role;
        const show = role === 'all' || memberRole === role;

        member.classList.toggle('hidden', !show);
        if (show) visibleCount++;
      });

      // Show/hide empty state
      noMembers?.classList.toggle('hidden', visibleCount > 0);

      // Update active chip
      chips.forEach((chip) => {
        chip.classList.toggle('active', (chip as HTMLElement).dataset.role === role);
      });
    };

    chips.forEach((chip) => {
      chip.addEventListener('click', () => {
        const role = (chip as HTMLElement).dataset.role || 'all';
        filterByRole(role);
      });
    });

    clearBtn?.addEventListener('click', () => filterByRole('all'));
  };

  initRoleFilters();
  document.addEventListener('astro:after-swap', initRoleFilters);
</script>
