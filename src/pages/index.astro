---
import Layout from '@layouts/Layout.astro';
import WaveDivider from '@components/shared/WaveDivider.astro';
import StudySitesMap from '@components/research/StudySitesMap';
import { posts } from '@data/posts';
import { studySystems, researchPillars } from '@data/research';

// Get 3 most recent news posts for carousel
const recentPosts = [...posts]
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 3);

// Format date helper
const formatDate = (dateStr: string) => {
  return new Date(dateStr).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
};
---

<Layout
  title="Home"
  description="Ocean Recoveries Lab at UC Santa Barbara - Leading research on coral reef resilience, kelp forest ecology, and marine conservation. We study how ocean ecosystems recover from disturbance through field experiments, modeling, and community partnerships."
  keywords={['Ocean Recoveries Lab', 'coral reef research', 'kelp forest ecology', 'marine conservation', 'UC Santa Barbara', 'Adrian Stier', 'ecosystem resilience', 'marine biology research']}
>
  <!-- Hero Section -->
  <section class="hero-section relative min-h-[100svh] flex items-center justify-center overflow-visible">
    <!-- Background Image with Parallax -->
    <div
      class="absolute inset-0 bg-cover bg-right md:bg-center bg-no-repeat parallax-bg"
      style="background-image: url('/images/coral-reef-panorama-anthias-fish.jpeg');"
    >
      <!-- Refined gradient for depth and readability - lighter on mobile to show more of the image -->
      <div class="absolute inset-0 bg-gradient-to-b from-navy-deep/30 via-navy-deep/20 to-navy-deep/90 md:from-navy-deep/50 md:via-navy-deep/30 md:to-navy-deep/95"></div>
      <!-- Subtle vignette for focus -->
      <div class="absolute inset-0" style="background: radial-gradient(ellipse at center, transparent 0%, rgba(11, 37, 69, 0.3) 100%);"></div>
    </div>

    <!-- Underwater Light Rays (Crepuscular Rays) -->
    <div class="light-rays" aria-hidden="true">
      <div class="light-ray ray-1"></div>
      <div class="light-ray ray-2"></div>
      <div class="light-ray ray-3"></div>
      <div class="light-ray ray-4"></div>
      <div class="light-ray ray-5"></div>
      <div class="light-ray ray-6"></div>
      <div class="light-ray ray-7"></div>
    </div>

    <!-- Floating Bubbles -->
    <div class="floating-bubbles" aria-hidden="true">
      <div class="bubble bubble-1"></div>
      <div class="bubble bubble-2"></div>
      <div class="bubble bubble-3"></div>
      <div class="bubble bubble-4"></div>
      <div class="bubble bubble-5"></div>
      <div class="bubble bubble-6"></div>
    </div>

    <!-- Hero Content -->
    <div class="relative z-10 container text-center px-4 pt-20 pb-32 md:pt-24 md:pb-40">
      <h1 class="hero-title mb-5 opacity-0">
        <span class="gradient-text">Ocean Recoveries</span>
        <span class="text-white block">Lab</span>
      </h1>

      <p class="hero-tagline text-xl md:text-2xl lg:text-3xl font-medium text-white mb-8 opacity-0 max-w-3xl mx-auto leading-relaxed">
        How ocean ecosystems heal—and how we can help.
      </p>

      <!-- Lab Director Card -->
      <a href="/people" class="hero-pi-card opacity-0 group">
        <img src="/images/adrian.png" alt="Adrian Stier" class="hero-pi-photo" />
        <div class="hero-pi-info">
          <span class="hero-pi-name">Adrian Stier</span>
          <span class="hero-pi-title">Principal Investigator · Associate Professor, UCSB</span>
        </div>
        <svg class="hero-pi-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>

      <div class="hero-cta flex flex-col sm:flex-row gap-4 justify-center opacity-0">
        <a href="#research" class="btn btn-primary btn-lg magnetic-btn group">
          <span>Explore Our Research</span>
          <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
        <a href="/join" class="btn btn-ghost btn-lg magnetic-btn">
          Join the Lab
        </a>
      </div>
    </div>

    <!-- Wave at bottom of hero -->
    <WaveDivider id="hero-wave" fillColor="surface" />
  </section>

  <!-- Study Systems Section with Interactive Map -->
  <section id="research" class="section-lg bg-surface relative overflow-visible">
    <!-- Animated Blob Shapes -->
    <div class="blob-container" aria-hidden="true">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
    </div>
    <div class="container relative z-10">
      <div class="text-center mb-10 scroll-reveal">
        <span class="eyebrow">Where We Work</span>
        <h2 class="mb-4">Our Field Sites</h2>
        <p class="lead max-w-2xl mx-auto">
          Two LTER sites across the Pacific. Click a location to explore our research.
        </p>
      </div>

      <!-- Interactive Map -->
      <div class="max-w-5xl mx-auto scroll-reveal">
        <StudySitesMap client:load />
      </div>

      <!-- Study System Cards (compact, below map) -->
      <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto mt-10">
        {studySystems.map((system, i) => (
          <a href={`/research/${system.slug}`} class={`ecosystem-card-compact scroll-reveal stagger-${i + 1} group`}>
            <div class="ecosystem-card-compact-image">
              <img
                src={system.heroImage}
                alt={system.title}
                loading="lazy"
              />
            </div>
            <div class="ecosystem-card-compact-content">
              <div class="ecosystem-location-compact">
                <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>{system.slug === 'coral-reefs' ? "Mo'orea" : 'Santa Barbara'}</span>
              </div>
              <h3 class="ecosystem-title-compact">{system.title}</h3>
              <p class="ecosystem-tagline-compact">{system.tagline}</p>
              <div class="ecosystem-link-compact">
                <span>Learn more</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Wave -->
    <WaveDivider id="study-wave" fillColor="navy-deep" />
  </section>

  <!-- Research Pillars Section -->
  <section class="section-lg bg-navy-deep relative overflow-visible">
    <div class="container">
      <div class="text-center mb-14 scroll-reveal">
        <span class="eyebrow text-accent-2">Our Approach</span>
        <h2 class="text-white mb-4">Research Focus</h2>
        <p class="lead max-w-2xl mx-auto text-white/60">
          Field experiments in Moorea and Santa Barbara. Models that predict real outcomes.
        </p>
      </div>

      <div class="pillars-grid">
        {researchPillars.map((pillar, i) => (
          <div class={`pillar-card scroll-reveal stagger-${i + 1}`}>
            <div class={`pillar-icon pillar-icon-${i + 1}`}>
              {i === 0 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                </svg>
              )}
              {i === 1 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              )}
              {i === 2 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              )}
            </div>
            <h3 class="pillar-title">{pillar.title}</h3>
            <p class="pillar-desc">{pillar.description}</p>
            <ul class="pillar-topics">
              {pillar.topics.slice(0, 3).map(topic => (
                <li>
                  <svg class="w-3 h-3 text-accent-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span>{topic}</span>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>

      <div class="text-center mt-14 scroll-reveal">
        <a href="/research" class="btn btn-ghost group">
          <span>Learn how we do science</span>
          <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Wave -->
    <WaveDivider id="pillars-wave" fillColor="surface" />
  </section>

  <!-- Recent News Section -->
  <section class="section-lg bg-surface relative overflow-visible">
    <div class="container">
      <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-10 scroll-reveal">
        <div>
          <span class="eyebrow">Latest Updates</span>
          <h2 class="mb-0">Recent Research</h2>
        </div>
        <a href="/news" class="btn btn-secondary hidden sm:inline-flex group">
          <span>View all news</span>
          <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>

      <!-- News Grid -->
      <div class="news-grid">
        {recentPosts.map((post, i) => (
          <article class={`news-card scroll-reveal stagger-${i + 1}`}>
            <a href={`/news/${post.slug}`} class="news-card-link group">
              <div class="news-card-image">
                <img
                  src={post.featuredImage}
                  alt={post.title}
                  loading={i === 0 ? 'eager' : 'lazy'}
                />
                <div class="news-card-date">
                  {formatDate(post.date)}
                </div>
              </div>
              <div class="news-card-body">
                <div class="news-card-tags">
                  {post.tags.slice(0, 2).map(tag => (
                    <span class="news-tag">{tag}</span>
                  ))}
                </div>
                <h3 class="news-card-title">{post.title}</h3>
                <p class="news-card-excerpt">{post.excerpt}</p>
                <div class="news-card-cta">
                  <span>Read article</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </div>
              </div>
            </a>
          </article>
        ))}
      </div>

      <div class="text-center mt-10 sm:hidden scroll-reveal">
        <a href="/news" class="btn btn-secondary">
          View All News
        </a>
      </div>
    </div>

    <!-- Wave -->
    <WaveDivider id="news-wave" fillColor="navy-deep" />
  </section>

  <!-- About / Impact Section -->
  <section class="section-lg bg-navy-deep relative overflow-visible">
    <!-- Subtle background texture -->
    <div class="absolute inset-0 opacity-[0.03]">
      <div class="absolute inset-0" style="background-image: url('/images/coral-reef-panorama-anthias-fish.jpeg'); background-size: cover; background-position: center; filter: grayscale(100%);"></div>
    </div>

    <div class="container relative z-10">
      <div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center">
        <div class="scroll-reveal">
          <span class="eyebrow text-accent-2">Our Lab</span>
          <h2 class="text-white mb-6">Based at UC Santa Barbara</h2>
          <p class="text-white/60 text-lg leading-relaxed mb-5">
            The Ocean Recoveries Lab is part of the Department of Ecology, Evolution & Marine Biology.
            We have running seawater systems, small boat access, and on-site dive facilities at UCSB's
            Marine Science Institute—plus field stations in Moorea and the Channel Islands.
          </p>
          <p class="text-white/60 leading-relaxed mb-6">
            Our team includes postdocs, grad students, and undergrads linking field experiments
            to management—like our MPA spillover work that informed Channel Islands fishery reviews.
          </p>

          <!-- Lab Director -->
          <a href="/people" class="pi-card group">
            <img src="/images/adrian.png" alt="Adrian Stier" class="pi-photo" />
            <div class="pi-info">
              <span class="pi-name">Adrian Stier</span>
              <span class="pi-title">Associate Professor, EEMB</span>
              <span class="pi-bio">Runs long-term experiments at MCR and SBC LTER sites. 75+ papers on reef and kelp dynamics.</span>
            </div>
            <svg class="pi-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>

          <a href="/people" class="btn btn-primary group mt-6">
            <span>Meet the Team</span>
            <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>

        <div class="stats-grid">
          <div class="stat-card scroll-reveal stagger-1">
            <span class="stat-number" data-target="75">0</span>
            <span class="stat-suffix">+</span>
            <span class="stat-label">Publications</span>
          </div>
          <div class="stat-card scroll-reveal stagger-2">
            <span class="stat-number" data-target="15">0</span>
            <span class="stat-suffix">yrs</span>
            <span class="stat-label">Research Experience</span>
          </div>
          <div class="stat-card scroll-reveal stagger-3">
            <span class="stat-number" data-target="2">0</span>
            <span class="stat-label">LTER Sites</span>
          </div>
          <div class="stat-card scroll-reveal stagger-4">
            <span class="stat-number" data-target="12">0</span>
            <span class="stat-suffix">+</span>
            <span class="stat-label">Partner Institutions</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Wave -->
    <WaveDivider id="about-wave" fillColor="surface" />
  </section>

  <!-- Dual CTA Section -->
  <section class="section bg-surface">
    <div class="container">
      <div class="grid md:grid-cols-2 gap-6 lg:gap-8">
        <!-- For Prospective Students/Postdocs -->
        <div class="join-cta scroll-reveal">
          <div class="join-cta-content">
            <span class="eyebrow text-accent">For Researchers</span>
            <h2 class="text-2xl md:text-3xl mb-4">Join Our Team</h2>
            <p class="text-muted max-w-md mx-auto mb-6">
              Looking for researchers who dive, build models, and publish open-access. Current needs: coral photogrammetry and kelp population modeling.
            </p>
            <a href="/join" class="btn btn-primary group">
              <span>View Opportunities</span>
              <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
          </div>
        </div>

        <!-- For Funders/Partners -->
        <div class="join-cta funder-cta scroll-reveal stagger-1">
          <div class="join-cta-content">
            <span class="eyebrow text-accent-2">For Funders</span>
            <h2 class="text-2xl md:text-3xl mb-4">Partner With Us</h2>
            <p class="text-muted max-w-md mx-auto mb-6">
              Support research that directly informs reef and kelp forest management. See our track record and explore funding opportunities.
            </p>
            <a href="/for-funders" class="btn btn-secondary group">
              <span>Learn More</span>
              <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* ========================================
     Underwater Light Rays (Crepuscular Rays)
     ======================================== */
  .light-rays {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 1;
  }

  .light-ray {
    @apply absolute;
    top: -20%;
    width: 120px;
    height: 140%;
    background: linear-gradient(
      180deg,
      rgba(56, 189, 248, 0.15) 0%,
      rgba(56, 189, 248, 0.08) 20%,
      rgba(45, 212, 191, 0.04) 50%,
      transparent 100%
    );
    transform-origin: top center;
    filter: blur(30px);
    opacity: 0;
    animation: light-ray-shimmer 12s ease-in-out infinite;
  }

  /* Distribute rays across the hero with varied angles */
  .ray-1 { left: 5%; transform: rotate(-15deg) skewX(-5deg); animation-delay: 0s; width: 80px; }
  .ray-2 { left: 18%; transform: rotate(-8deg) skewX(-3deg); animation-delay: 2s; width: 100px; }
  .ray-3 { left: 32%; transform: rotate(-3deg) skewX(-1deg); animation-delay: 4s; width: 140px; }
  .ray-4 { left: 48%; transform: rotate(2deg) skewX(1deg); animation-delay: 1s; width: 160px; }
  .ray-5 { left: 62%; transform: rotate(6deg) skewX(2deg); animation-delay: 3s; width: 120px; }
  .ray-6 { left: 78%; transform: rotate(10deg) skewX(4deg); animation-delay: 5s; width: 90px; }
  .ray-7 { left: 90%; transform: rotate(14deg) skewX(5deg); animation-delay: 2.5s; width: 70px; }

  @keyframes light-ray-shimmer {
    0%, 100% {
      opacity: 0;
      filter: blur(30px);
    }
    15%, 85% {
      opacity: 0.5;
      filter: blur(25px);
    }
    50% {
      opacity: 0.7;
      filter: blur(20px);
    }
  }

  /* ========================================
     Floating Bubbles
     ======================================== */
  .floating-bubbles {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 1;
  }

  .bubble {
    @apply absolute rounded-full;
    background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.3), rgba(45, 212, 191, 0.1));
    animation: float-up linear infinite;
    opacity: 0;
  }

  .bubble-1 { width: 25px; height: 25px; left: 8%; animation-duration: 14s; animation-delay: 0s; }
  .bubble-2 { width: 40px; height: 40px; left: 22%; animation-duration: 18s; animation-delay: 3s; }
  .bubble-3 { width: 18px; height: 18px; left: 45%; animation-duration: 12s; animation-delay: 5s; }
  .bubble-4 { width: 30px; height: 30px; left: 65%; animation-duration: 16s; animation-delay: 2s; }
  .bubble-5 { width: 35px; height: 35px; left: 80%; animation-duration: 15s; animation-delay: 4s; }
  .bubble-6 { width: 20px; height: 20px; left: 92%; animation-duration: 13s; animation-delay: 6s; }

  @keyframes float-up {
    0% {
      transform: translateY(100vh) scale(0.5);
      opacity: 0;
    }
    10% { opacity: 0.6; }
    90% { opacity: 0.6; }
    100% {
      transform: translateY(-100px) scale(1);
      opacity: 0;
    }
  }

  /* ========================================
     Animated Blob Shapes
     ======================================== */
  .blob-container {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 0;
  }

  .blob {
    @apply absolute rounded-full;
    filter: blur(80px);
    animation: blob-morph 20s ease-in-out infinite;
  }

  .blob-1 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(56, 189, 248, 0.12) 0%, transparent 70%);
    top: -100px;
    right: -100px;
  }

  .blob-2 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(45, 212, 191, 0.1) 0%, transparent 70%);
    bottom: -50px;
    left: -100px;
    animation-delay: -10s;
  }

  @keyframes blob-morph {
    0%, 100% {
      transform: translate(0, 0) scale(1) rotate(0deg);
      border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
    }
    25% {
      transform: translate(30px, -50px) scale(1.1) rotate(90deg);
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    }
    50% {
      transform: translate(-20px, 20px) scale(0.95) rotate(180deg);
      border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
    }
    75% {
      transform: translate(20px, 40px) scale(1.05) rotate(270deg);
      border-radius: 50% 40% 50% 60% / 40% 60% 50% 40%;
    }
  }

  /* ========================================
     Gradient Text
     ======================================== */
  .gradient-text {
    background: linear-gradient(135deg, #ffffff 0%, #38bdf8 40%, #2dd4bf 80%, #38bdf8 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 8s ease-in-out infinite;
  }

  @keyframes gradient-shift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* ========================================
     Hero Section
     ======================================== */
  .hero-badge {
    animation: fadeDown 0.6s ease-out 0.1s forwards;
  }

  .hero-title {
    animation: fadeUp 0.8s ease-out 0.2s forwards;
    text-shadow: 0 4px 24px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .hero-tagline {
    animation: fadeUp 0.8s ease-out 0.35s forwards;
    text-shadow: 0 2px 16px rgba(0, 0, 0, 0.3);
  }

  .hero-description {
    animation: fadeUp 0.8s ease-out 0.5s forwards;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.2);
  }

  .hero-cta {
    animation: fadeUp 0.8s ease-out 0.65s forwards;
  }

  /* Hero PI Card */
  .hero-pi-card {
    @apply inline-flex items-center gap-3 px-4 py-3 rounded-full no-underline;
    @apply bg-white/10 backdrop-blur-sm border border-white/20;
    @apply transition-all duration-300 mb-8;
    animation: fadeUp 0.8s ease-out 0.5s forwards;
  }

  .hero-pi-card:hover {
    @apply bg-white/20;
    border-color: rgba(56, 189, 248, 0.4);
    transform: translateY(-2px);
  }

  .hero-pi-photo {
    @apply w-10 h-10 rounded-full object-cover;
    @apply border-2 border-white/30;
  }

  .hero-pi-info {
    @apply flex flex-col text-left;
  }

  .hero-pi-name {
    @apply text-white font-bold text-sm;
  }

  .hero-pi-title {
    @apply text-white/70 text-xs;
  }

  .hero-pi-arrow {
    @apply w-4 h-4 text-white/50 ml-1;
    @apply transition-all duration-200;
  }

  .hero-pi-card:hover .hero-pi-arrow {
    @apply text-white translate-x-0.5;
  }

  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(24px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeDown {
    from {
      opacity: 0;
      transform: translateY(-16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .btn-lg {
    @apply px-7 py-3.5 text-base;
  }

  /* Scroll indicator */
  .scroll-mouse {
    transition: border-color 0.3s ease;
  }

  .scroll-dot {
    animation: scrollHint 1.5s ease-in-out infinite;
  }

  @keyframes scrollHint {
    0%, 100% {
      opacity: 1;
      transform: translateY(0);
    }
    50% {
      opacity: 0.3;
      transform: translateY(12px);
    }
  }

  /* Parallax */
  .parallax-bg {
    transform: translateZ(0);
    will-change: transform;
  }

  /* ========================================
     Section spacing
     ======================================== */
  .section-lg {
    @apply py-20 md:py-28 pb-28 md:pb-36;
  }

  /* ========================================
     Ecosystem Cards (Study Systems)
     ======================================== */
  .ecosystem-card {
    @apply relative rounded-2xl overflow-hidden no-underline block;
    @apply border border-line/50;
    @apply transition-all duration-500 ease-out;
    aspect-ratio: 4 / 3;
    transform-style: preserve-3d;
  }

  .ecosystem-card:hover {
    @apply -translate-y-2;
    border-color: rgba(56, 189, 248, 0.4);
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.4),
      0 0 40px rgba(56, 189, 248, 0.15);
  }

  .ecosystem-card-image {
    @apply absolute inset-0;
  }

  .ecosystem-card-image img {
    @apply w-full h-full object-cover;
    @apply transition-all duration-700 ease-out;
    transform: scale(1.05);
  }

  .ecosystem-card:hover .ecosystem-card-image img {
    transform: scale(1.12);
  }

  .ecosystem-card-overlay {
    @apply absolute inset-0;
    background: linear-gradient(
      to top,
      rgba(11, 37, 69, 0.95) 0%,
      rgba(11, 37, 69, 0.7) 35%,
      rgba(11, 37, 69, 0.3) 60%,
      transparent 100%
    );
  }

  .ecosystem-card-content {
    @apply absolute bottom-0 left-0 right-0 p-6 md:p-7;
  }

  .ecosystem-location {
    @apply inline-flex items-center gap-1.5 text-accent-2 text-xs font-bold uppercase tracking-wider mb-3;
  }

  .ecosystem-title {
    @apply text-2xl md:text-3xl font-black text-white mb-3;
    @apply transition-colors duration-300;
  }

  .ecosystem-card:hover .ecosystem-title {
    @apply text-accent;
  }

  .ecosystem-tagline {
    @apply text-white/70 text-sm leading-relaxed mb-4 line-clamp-2;
  }

  .ecosystem-link {
    @apply inline-flex items-center gap-2 text-accent text-sm font-bold;
    @apply transition-all duration-300;
  }

  .ecosystem-card:hover .ecosystem-link {
    @apply gap-3;
  }

  /* ========================================
     Compact Ecosystem Cards (below map)
     ======================================== */
  .ecosystem-card-compact {
    @apply flex rounded-xl overflow-hidden no-underline;
    @apply bg-surface-card border border-line/50;
    @apply transition-all duration-300 ease-out;
  }

  .ecosystem-card-compact:hover {
    @apply -translate-y-1;
    border-color: rgba(56, 189, 248, 0.4);
    box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.3);
  }

  .ecosystem-card-compact-image {
    @apply w-24 md:w-32 flex-shrink-0;
  }

  .ecosystem-card-compact-image img {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500;
  }

  .ecosystem-card-compact:hover .ecosystem-card-compact-image img {
    @apply scale-110;
  }

  .ecosystem-card-compact-content {
    @apply flex-1 p-4 md:p-5 flex flex-col justify-center;
  }

  .ecosystem-location-compact {
    @apply inline-flex items-center gap-1 text-accent-2 text-xs font-bold uppercase tracking-wider mb-1.5;
  }

  .ecosystem-title-compact {
    @apply text-base md:text-lg font-bold text-ink mb-1;
    @apply transition-colors duration-200;
  }

  .ecosystem-card-compact:hover .ecosystem-title-compact {
    @apply text-accent;
  }

  .ecosystem-tagline-compact {
    @apply text-muted text-xs md:text-sm leading-relaxed mb-2 line-clamp-2;
  }

  .ecosystem-link-compact {
    @apply inline-flex items-center gap-1.5 text-accent text-xs font-bold;
    @apply transition-all duration-200;
  }

  .ecosystem-card-compact:hover .ecosystem-link-compact {
    @apply gap-2;
  }

  /* ========================================
     Research Pillars
     ======================================== */
  .pillars-grid {
    @apply grid md:grid-cols-3 gap-6 lg:gap-8 max-w-6xl mx-auto;
  }

  .pillar-card {
    @apply p-7 rounded-2xl text-left;
    @apply border border-white/10;
    @apply transition-all duration-300 ease-out;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .pillar-card::before {
    content: '';
    @apply absolute inset-0 rounded-2xl opacity-0;
    background: linear-gradient(135deg, rgba(56, 189, 248, 0.08) 0%, rgba(45, 212, 191, 0.04) 100%);
    transition: opacity 0.3s ease;
    z-index: -1;
  }

  .pillar-card:hover {
    @apply -translate-y-2;
    border-color: rgba(56, 189, 248, 0.4);
    box-shadow:
      0 20px 40px -12px rgba(0, 0, 0, 0.3),
      0 0 30px rgba(56, 189, 248, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .pillar-card:hover::before {
    opacity: 1;
  }

  .pillar-icon {
    @apply w-12 h-12 mb-5 rounded-xl;
    @apply flex items-center justify-center;
    @apply transition-all duration-500;
    position: relative;
  }

  .pillar-card:hover .pillar-icon {
    @apply scale-110;
    animation: icon-bounce 0.6s ease;
  }

  .pillar-card:hover .pillar-icon svg {
    animation: icon-wiggle 0.6s ease;
  }

  @keyframes icon-bounce {
    0%, 100% { transform: scale(1.1) translateY(0); }
    50% { transform: scale(1.15) translateY(-3px); }
  }

  @keyframes icon-wiggle {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(-8deg); }
    75% { transform: rotate(8deg); }
    100% { transform: rotate(0deg); }
  }

  .pillar-icon-1 {
    @apply bg-accent/20 text-accent;
  }

  .pillar-icon-2 {
    @apply bg-accent-2/20 text-accent-2;
  }

  .pillar-icon-3 {
    @apply bg-accent-warm/20 text-accent-warm;
  }

  .pillar-title {
    @apply text-white text-lg font-bold mb-3;
  }

  .pillar-desc {
    @apply text-white/50 text-sm leading-relaxed mb-5;
  }

  .pillar-topics {
    @apply space-y-2;
  }

  .pillar-topics li {
    @apply flex items-start gap-2 text-white/70 text-sm;
  }

  /* ========================================
     News Cards
     ======================================== */
  .news-grid {
    @apply grid md:grid-cols-3 gap-6 lg:gap-8;
  }

  .news-card {
    @apply rounded-2xl overflow-hidden bg-surface-card;
    @apply border border-line/50;
    @apply transition-all duration-300 ease-out;
  }

  .news-card:hover {
    @apply -translate-y-2 shadow-xl;
    border-color: rgba(56, 189, 248, 0.3);
  }

  .news-card-link {
    @apply block no-underline h-full flex flex-col;
  }

  .news-card-image {
    @apply relative aspect-[16/10] overflow-hidden;
  }

  .news-card-image img {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500 ease-out;
  }

  .news-card:hover .news-card-image img {
    @apply scale-105;
  }

  .news-card-date {
    @apply absolute top-3 right-3;
    @apply px-3 py-1.5 rounded-full;
    @apply bg-navy-deep/80 backdrop-blur-sm;
    @apply text-white/80 text-xs font-medium;
  }

  .news-card-body {
    @apply p-5 md:p-6 flex flex-col flex-1;
  }

  .news-card-tags {
    @apply flex flex-wrap gap-2 mb-3;
  }

  .news-tag {
    @apply text-xs font-bold uppercase tracking-wide;
    @apply text-accent;
  }

  .news-card-title {
    @apply text-lg font-bold text-ink mb-3 leading-snug;
    @apply transition-colors duration-200;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .news-card:hover .news-card-title {
    @apply text-accent;
  }

  .news-card-excerpt {
    @apply text-muted text-sm leading-relaxed mb-4 flex-1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .news-card-cta {
    @apply inline-flex items-center gap-2 text-accent text-sm font-bold;
    @apply transition-all duration-300 mt-auto;
  }

  .news-card:hover .news-card-cta {
    @apply gap-3;
  }

  /* ========================================
     PI Card - Compact Lab Director
     ======================================== */
  .pi-card {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 0.75rem 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-bottom: 0;
  }

  .pi-card:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(56, 189, 248, 0.3);
  }

  .pi-photo {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(56, 189, 248, 0.3);
    flex-shrink: 0;
  }

  .pi-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    flex: 1;
    min-width: 0;
  }

  .pi-name {
    font-size: 0.875rem;
    font-weight: 700;
    color: #f1f5f9;
  }

  .pi-title {
    font-size: 0.6875rem;
    font-weight: 600;
    color: #38bdf8;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .pi-bio {
    font-size: 0.75rem;
    color: rgba(241, 245, 249, 0.5);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .pi-arrow {
    width: 1rem;
    height: 1rem;
    color: rgba(56, 189, 248, 0.4);
    flex-shrink: 0;
    transition: all 0.2s ease;
  }

  .pi-card:hover .pi-arrow {
    color: #38bdf8;
    transform: translateX(3px);
  }

  /* ========================================
     Stats Section
     ======================================== */
  .stats-grid {
    @apply grid grid-cols-2 gap-4 lg:gap-5;
  }

  .stat-card {
    @apply relative bg-white/[0.03] border border-white/10 rounded-2xl;
    @apply p-6 lg:p-7 text-center;
    @apply transition-all duration-300 ease-out;
  }

  .stat-card:hover {
    @apply bg-white/[0.06] -translate-y-1;
    border-color: rgba(56, 189, 248, 0.3);
  }

  .stat-number {
    @apply text-4xl lg:text-5xl font-black text-accent;
    @apply inline;
  }

  .stat-suffix {
    @apply text-xl lg:text-2xl font-bold text-accent/70 ml-0.5;
  }

  .stat-label {
    @apply block text-xs font-semibold text-white/50 uppercase tracking-wider mt-2;
  }

  /* ========================================
     Join CTA
     ======================================== */
  .join-cta {
    @apply relative rounded-2xl overflow-hidden;
    @apply bg-gradient-to-br from-accent/10 via-accent/5 to-accent-2/10;
    @apply border border-accent/20;
    @apply p-8 md:p-10;
  }

  .join-cta::before {
    content: '';
    @apply absolute inset-0 opacity-30;
    background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.15), transparent 50%),
                radial-gradient(circle at bottom left, rgba(45, 212, 191, 0.15), transparent 50%);
  }

  .join-cta-content {
    @apply relative z-10 text-center;
  }

  .funder-cta {
    @apply bg-gradient-to-br from-accent-2/10 via-accent-2/5 to-accent/10;
    @apply border-accent-2/20;
  }

  .funder-cta::before {
    background: radial-gradient(circle at top right, rgba(45, 212, 191, 0.15), transparent 50%),
                radial-gradient(circle at bottom left, rgba(56, 189, 248, 0.15), transparent 50%);
  }

  /* ========================================
     Reduced motion
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .hero-badge,
    .hero-title,
    .hero-tagline,
    .hero-description,
    .hero-cta,
    .gradient-text {
      animation: none;
      opacity: 1;
    }

    .scroll-dot,
    .bubble,
    .blob,
    .light-ray {
      animation: none;
    }

    .ecosystem-card-image img,
    .news-card-image img {
      transition: none;
    }

    .pillar-card,
    .ecosystem-card,
    .news-card,
    .stat-card {
      transition: none;
    }

    .pillar-icon,
    .pillar-icon svg {
      animation: none;
    }
  }
</style>

<script>
  // Parallax effect for hero
  const initParallax = () => {
    const parallaxBg = document.querySelector('.parallax-bg') as HTMLElement;
    if (!parallaxBg) return;

    let ticking = false;

    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          const scrolled = window.scrollY;
          const rate = scrolled * 0.35;
          parallaxBg.style.transform = `translateY(${rate}px)`;
          ticking = false;
        });
        ticking = true;
      }
    };

    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      window.addEventListener('scroll', handleScroll, { passive: true });
    }
  };

  // Count-up animation for stats
  const initCountUp = () => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const el = entry.target as HTMLElement;
            const target = parseInt(el.dataset.target || '0', 10);
            animateCount(el, target);
            observer.unobserve(el);
          }
        });
      },
      { threshold: 0.5 }
    );

    document.querySelectorAll('.stat-number[data-target]').forEach((el) => {
      observer.observe(el);
    });
  };

  const animateCount = (el: HTMLElement, target: number) => {
    const duration = 1800;
    const start = performance.now();

    const update = (currentTime: number) => {
      const elapsed = currentTime - start;
      const progress = Math.min(elapsed / duration, 1);

      // Smooth easing
      const eased = 1 - Math.pow(1 - progress, 4);
      const current = Math.round(eased * target);

      el.textContent = current.toString();

      if (progress < 1) {
        requestAnimationFrame(update);
      }
    };

    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      el.textContent = target.toString();
    } else {
      requestAnimationFrame(update);
    }
  };

  // Initialize
  initParallax();
  initCountUp();

  // Re-init after view transitions
  document.addEventListener('astro:after-swap', () => {
    initParallax();
    initCountUp();
  });
</script>
