---
import Layout from '@layouts/Layout.astro';
import Breadcrumbs from '@components/layout/Breadcrumbs.astro';
import BreadcrumbSchema from '@components/seo/BreadcrumbSchema.astro';
import { researchThemes } from '@data/research';
import { publications } from '@data/publications';
import { posts } from '@data/posts';
import { enrichPublicationsWithImages } from '@utils/publicationImages';

export function getStaticPaths() {
  return researchThemes.map((theme) => ({
    params: { slug: theme.slug },
    props: { theme },
  }));
}

const { theme } = Astro.props;

// Enrich publications with news post data
const enrichedPubs = enrichPublicationsWithImages(publications, posts);

// Map slug to publication theme
const themeToPublicationMap: Record<string, string> = {
  'coral-reefs': 'Coral',
  'kelp-forests': 'Kelp',
};

const publicationTheme = themeToPublicationMap[theme.slug] || theme.title;

// Get related publications (matching theme, sorted by year and citations)
const relatedPubs = enrichedPubs
  .filter(pub => pub.themes.some(t => t.toLowerCase().includes(publicationTheme.toLowerCase())))
  .sort((a, b) => b.year - a.year || (b.citationCount || 0) - (a.citationCount || 0))
  .slice(0, 6);

const breadcrumbs = [
  { label: 'Research', href: '/research' },
  { label: theme.title },
];
---

<Layout
  title={theme.title}
  description={theme.tagline}
  image={theme.heroImage}
  keywords={[theme.title, 'marine ecology', 'ocean research', 'UCSB', 'marine conservation']}
>
  <!-- SEO Structured Data -->
  <BreadcrumbSchema
    items={[
      { name: 'Research', url: '/research' },
      { name: theme.title, url: `/research/${theme.slug}` }
    ]}
  />

  <!-- Hero -->
  <section class="relative py-24 md:py-32 overflow-hidden">
    <div
      class="absolute inset-0 bg-cover bg-center parallax-bg"
      style={`background-image: url('${theme.heroImage}');`}
    >
      <div class="absolute inset-0 bg-gradient-to-b from-navy-deep/30 via-navy-deep/20 to-navy-deep/85 md:from-navy-deep/50 md:via-navy-deep/40 md:to-navy-deep/90"></div>
    </div>

    <!-- Floating Bubbles -->
    <div class="floating-bubbles" aria-hidden="true">
      <div class="bubble bubble-1"></div>
      <div class="bubble bubble-2"></div>
      <div class="bubble bubble-3"></div>
      <div class="bubble bubble-4"></div>
    </div>

    <div class="relative z-10 container text-white">
      <Breadcrumbs items={breadcrumbs} class="mb-6" />
      <h1 class="mb-4 hero-title">
        <span class="gradient-text">{theme.title}</span>
      </h1>
      <p class="text-xl text-white/80 max-w-3xl hero-tagline">{theme.tagline}</p>
    </div>
  </section>

  <!-- Species Silhouette Border Pattern -->
  <div class="species-border" aria-hidden="true">
    {theme.slug === 'coral-reefs' && (
      <svg class="species-silhouette coral-silhouette" viewBox="0 0 1200 120" preserveAspectRatio="none">
        <path class="silhouette-path" d="M0,120 L0,80 Q30,60 60,80 Q90,95 120,75 Q140,60 160,70 Q180,85 200,65 Q220,50 240,70 Q260,90 280,70 Q310,45 340,75 Q360,90 380,60 Q400,40 420,55 Q450,75 480,60 Q500,45 520,65 Q550,85 580,55 Q600,35 620,60 Q650,85 680,55 Q700,40 720,70 Q750,95 780,60 Q800,40 820,65 Q850,90 880,55 Q900,35 920,60 Q950,85 980,50 Q1000,30 1020,55 Q1050,80 1080,50 Q1100,35 1120,60 Q1150,85 1180,55 L1200,50 L1200,120 Z" />
        <circle class="silhouette-bubble bubble-1" cx="100" cy="40" r="4" />
        <circle class="silhouette-bubble bubble-2" cx="350" cy="25" r="3" />
        <circle class="silhouette-bubble bubble-3" cx="600" cy="35" r="5" />
        <circle class="silhouette-bubble bubble-4" cx="850" cy="20" r="3" />
        <circle class="silhouette-bubble bubble-5" cx="1100" cy="30" r="4" />
      </svg>
    )}
    {theme.slug === 'kelp-forests' && (
      <svg class="species-silhouette kelp-silhouette" viewBox="0 0 1200 120" preserveAspectRatio="none">
        <path class="silhouette-path kelp-frond frond-1" d="M50,120 Q55,100 50,80 Q45,60 55,40 Q60,25 50,10 Q45,0 55,-10" />
        <path class="silhouette-path kelp-frond frond-2" d="M150,120 Q145,95 155,70 Q165,50 150,30 Q140,15 155,0" />
        <path class="silhouette-path kelp-frond frond-3" d="M300,120 Q310,90 295,60 Q285,35 305,15 Q315,0 300,-10" />
        <path class="silhouette-path kelp-frond frond-4" d="M450,120 Q440,100 455,75 Q465,55 445,35 Q435,20 455,5" />
        <path class="silhouette-path kelp-frond frond-5" d="M600,120 Q610,85 595,55 Q585,30 605,10 Q615,-5 600,-15" />
        <path class="silhouette-path kelp-frond frond-6" d="M750,120 Q740,95 755,65 Q770,40 750,20 Q735,5 755,-5" />
        <path class="silhouette-path kelp-frond frond-7" d="M900,120 Q915,90 895,60 Q880,35 905,15 Q920,0 900,-10" />
        <path class="silhouette-path kelp-frond frond-8" d="M1050,120 Q1040,100 1055,70 Q1070,45 1045,25 Q1030,10 1055,0" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-1" cx="55" cy="15" rx="8" ry="6" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-2" cx="150" cy="5" rx="7" ry="5" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-3" cx="300" cy="10" rx="9" ry="6" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-4" cx="455" cy="8" rx="7" ry="5" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-5" cx="600" cy="5" rx="8" ry="6" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-6" cx="755" cy="12" rx="7" ry="5" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-7" cx="905" cy="8" rx="8" ry="6" />
        <ellipse class="silhouette-bubble kelp-bladder bladder-8" cx="1055" cy="5" rx="7" ry="5" />
      </svg>
    )}
  </div>

  <!-- Overview -->
  <section class="section bg-surface">
    <div class="container">
      <div class="max-w-3xl scroll-reveal">
        <span class="eyebrow">Overview</span>
        <div class="prose prose-invert">
          {theme.description.split('\n\n').map((paragraph) => (
            <p class="text-lg text-muted leading-relaxed mb-4">
              {paragraph}
            </p>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Key Questions -->
  <section class="section bg-navy-highlight">
    <div class="container">
      <div class="text-center mb-12 scroll-reveal">
        <span class="eyebrow">Research Focus</span>
        <h2>Key Questions</h2>
      </div>

      <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
        {theme.questions.map((question, i) => (
          <div class={`question-card scroll-reveal stagger-${i + 1}`}>
            <span class="question-number">{i + 1}</span>
            <p class="text-ink font-medium">{question}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Key Findings -->
  <section class="section bg-surface">
    <div class="container">
      <div class="text-center mb-12 scroll-reveal">
        <span class="eyebrow">Discoveries</span>
        <h2>Key Findings</h2>
        <p class="text-sm text-muted mt-2 md:hidden">Tap cards to reveal details</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        {theme.findings.map((finding, i) => (
          <button
            type="button"
            class={`finding-card scroll-reveal stagger-${i + 1}`}
            aria-label={`${finding.title}. Tap to reveal details.`}
          >
            <div class="finding-front">
              <div class="finding-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
              </div>
              <h3 class="finding-title">{finding.title}</h3>
              <p class="finding-summary">{finding.summary}</p>
              <span class="finding-hint hidden md:block">Hover for details</span>
              <span class="finding-hint md:hidden">Tap for details</span>
            </div>
            <div class="finding-back">
              <p class="finding-detail">{finding.detail}</p>
              <span class="finding-hint md:hidden mt-4">Tap to go back</span>
            </div>
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Photo Gallery -->
  {theme.gallery && theme.gallery.length > 0 && (
    <section class="section bg-navy-highlight">
      <div class="container">
        <div class="text-center mb-12 scroll-reveal">
          <span class="eyebrow">From the Field</span>
          <h2>Photo Gallery</h2>
        </div>

        <div class="gallery-grid">
          {theme.gallery.map((image, i) => (
            <figure class={`gallery-item scroll-reveal stagger-${(i % 4) + 1}`}>
              <div class="gallery-img-container">
                <img
                  src={image.src}
                  alt={image.alt}
                  loading="lazy"
                  class="gallery-img"
                />
              </div>
              {image.caption && (
                <figcaption class="gallery-caption">{image.caption}</figcaption>
              )}
            </figure>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Field Site -->
  {theme.fieldSite && (
    <section class="section bg-surface">
      <div class="container">
        <div class="field-site-card scroll-reveal">
          <div class="field-site-image">
            <img
              src={theme.fieldSite.image}
              alt={theme.fieldSite.name}
              loading="lazy"
            />
          </div>
          <div class="field-site-content">
            <span class="eyebrow">Field Site</span>
            {theme.fieldSite.url ? (
              <a href={theme.fieldSite.url} target="_blank" rel="noopener noreferrer" class="field-site-link">
                <h3 class="field-site-name">{theme.fieldSite.name}</h3>
                <svg class="field-site-external-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </a>
            ) : (
              <h3 class="field-site-name">{theme.fieldSite.name}</h3>
            )}
            <p class="field-site-location">{theme.fieldSite.location}</p>
            <p class="field-site-description">{theme.fieldSite.description}</p>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Related Publications -->
  {relatedPubs.length > 0 && (
    <section class="section bg-navy-highlight">
      <div class="container">
        <div class="text-center mb-12 scroll-reveal">
          <span class="eyebrow">Featured Research</span>
          <h2>Related Publications</h2>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {relatedPubs.map((pub, i) => (
            <article class={`pub-card scroll-reveal stagger-${(i % 3) + 1}`}>
              {pub.image && (
                <div class="pub-image">
                  <img src={pub.image} alt="" loading="lazy" />
                </div>
              )}
              <div class="pub-content">
                <div class="pub-year">{pub.year}</div>
                <h3 class="pub-title">{pub.title}</h3>
                <p class="pub-authors">{pub.authors.split(',').slice(0, 3).join(', ')}{pub.authors.split(',').length > 3 ? ' et al.' : ''}</p>
                <div class="pub-meta">
                  <span class="pub-journal">{pub.journal}</span>
                  {pub.citationCount && pub.citationCount > 0 && (
                    <span class="pub-citations">{pub.citationCount} citations</span>
                  )}
                </div>
                <div class="pub-links">
                  {pub.newsSlug && (
                    <a href={`/news/${pub.newsSlug}`} class="pub-link pub-link-news">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                      </svg>
                      Read Summary
                    </a>
                  )}
                  {pub.doi && (
                    <a
                      href={`https://doi.org/${pub.doi}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="pub-link"
                    >
                      View Paper
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                      </svg>
                    </a>
                  )}
                </div>
              </div>
            </article>
          ))}
        </div>

        <div class="text-center mt-10 scroll-reveal">
          <a href="/publications" class="btn btn-secondary">
            View All Publications
          </a>
        </div>
      </div>
    </section>
  )}

  <!-- CTA -->
  <section class="section bg-navy-deep">
    <div class="container text-center">
      <h2 class="text-white mb-4 scroll-reveal">Want to Learn More?</h2>
      <p class="text-white/70 max-w-xl mx-auto mb-8 scroll-reveal">
        Explore our other research areas or get in touch to discuss potential collaborations.
      </p>
      <div class="flex flex-wrap justify-center gap-4 scroll-reveal">
        <a href="/research" class="btn btn-primary">
          All Research Areas
        </a>
        <a href="/join" class="btn btn-secondary">
          Join the Lab
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Floating Bubbles */
  .floating-bubbles {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 1;
  }

  .bubble {
    @apply absolute rounded-full;
    background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.3), rgba(45, 212, 191, 0.1));
    animation: float-up linear infinite;
    opacity: 0;
  }

  .bubble-1 { width: 20px; height: 20px; left: 15%; animation-duration: 12s; animation-delay: 0s; }
  .bubble-2 { width: 30px; height: 30px; left: 40%; animation-duration: 15s; animation-delay: 2s; }
  .bubble-3 { width: 25px; height: 25px; left: 65%; animation-duration: 13s; animation-delay: 4s; }
  .bubble-4 { width: 18px; height: 18px; left: 85%; animation-duration: 11s; animation-delay: 1s; }

  @keyframes float-up {
    0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
    10% { opacity: 0.6; }
    90% { opacity: 0.6; }
    100% { transform: translateY(-100px) scale(1); opacity: 0; }
  }

  /* Gradient Text */
  .gradient-text {
    background: linear-gradient(135deg, #ffffff 0%, #38bdf8 40%, #2dd4bf 80%, #38bdf8 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 8s ease-in-out infinite;
  }

  @keyframes gradient-shift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .hero-title {
    animation: fadeUp 0.6s ease-out forwards;
    opacity: 0;
  }

  .hero-tagline {
    opacity: 0;
    animation: fadeUp 0.6s ease-out 0.2s forwards;
  }

  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .parallax-bg {
    transform: translateZ(0);
    will-change: transform;
  }

  .question-card {
    @apply flex gap-4 p-5 rounded-xl;
    @apply bg-surface-card border border-line;
    @apply transition-all duration-300;
  }

  .question-card:hover {
    @apply -translate-y-1 shadow-lg border-accent/30;
  }

  .question-number {
    @apply flex-shrink-0 w-8 h-8 rounded-full;
    @apply bg-accent/20 text-accent;
    @apply flex items-center justify-center font-bold text-sm;
  }

  /* Flip card styles */
  .finding-card {
    @apply relative h-64 rounded-xl w-full text-left cursor-pointer;
    perspective: 1000px;
    background: transparent;
    border: none;
    padding: 0;
  }

  .finding-card:focus {
    @apply outline-none ring-2 ring-accent ring-offset-2;
  }

  .finding-front,
  .finding-back {
    @apply absolute inset-0 rounded-xl p-6;
    @apply flex flex-col;
    backface-visibility: hidden;
    transition: transform 0.6s ease;
  }

  .finding-front {
    @apply bg-surface-card border border-line;
  }

  .finding-back {
    @apply bg-gradient-to-br from-accent/20 to-accent-2/20;
    @apply border border-accent/30;
    @apply justify-center;
    transform: rotateY(180deg);
  }

  /* Desktop: hover to flip */
  @media (min-width: 768px) {
    .finding-card:hover .finding-front,
    .finding-card:focus .finding-front {
      transform: rotateY(-180deg);
    }

    .finding-card:hover .finding-back,
    .finding-card:focus .finding-back {
      transform: rotateY(0deg);
    }
  }

  /* Mobile: tap to flip via .flipped class */
  @media (max-width: 767px) {
    .finding-card.flipped .finding-front {
      transform: rotateY(-180deg);
    }

    .finding-card.flipped .finding-back {
      transform: rotateY(0deg);
    }
  }

  .finding-icon {
    @apply w-12 h-12 rounded-xl mb-4;
    @apply bg-accent/20 text-accent;
    @apply flex items-center justify-center;
  }

  .finding-title {
    @apply font-bold text-lg text-ink mb-2;
  }

  .finding-summary {
    @apply text-sm text-muted flex-1;
  }

  .finding-hint {
    @apply text-xs text-accent font-medium mt-2;
  }

  .finding-detail {
    @apply text-sm text-ink leading-relaxed font-medium;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .hero-title,
    .hero-tagline,
    .gradient-text,
    .bubble {
      animation: none;
    }
    .hero-title,
    .hero-tagline {
      opacity: 1;
    }

    .finding-front,
    .finding-back {
      transition: none;
    }

    .finding-card:hover .finding-front {
      transform: none;
    }

    .finding-card:hover .finding-back {
      transform: rotateY(180deg);
    }
  }

  /* Publication card styles */
  .pub-card {
    @apply flex flex-col rounded-xl overflow-hidden;
    @apply bg-surface-card border border-line;
    @apply transition-all duration-300;
  }

  .pub-card:hover {
    @apply -translate-y-1 shadow-lg border-accent/30;
  }

  .pub-image {
    @apply aspect-[16/9] overflow-hidden;
  }

  .pub-image img {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500;
  }

  .pub-card:hover .pub-image img {
    @apply scale-105;
  }

  .pub-content {
    @apply flex flex-col flex-1 p-5;
  }

  .pub-year {
    @apply text-xs font-bold text-accent mb-2;
  }

  .pub-title {
    @apply text-base font-bold text-ink mb-2 line-clamp-3;
  }

  .pub-authors {
    @apply text-sm text-muted mb-3 line-clamp-1;
  }

  .pub-meta {
    @apply flex items-center gap-3 text-xs text-muted-2 mb-4;
  }

  .pub-journal {
    @apply italic;
  }

  .pub-citations {
    @apply flex items-center gap-1;
  }

  .pub-links {
    @apply flex flex-wrap items-center gap-3;
    @apply mt-auto pt-3 border-t border-line;
  }

  .pub-link {
    @apply inline-flex items-center gap-1.5 text-sm font-medium;
    @apply text-accent hover:text-accent-2 no-underline;
    @apply transition-colors;
  }

  .pub-link-news {
    @apply text-accent-2 hover:text-accent;
  }

  /* Photo Gallery */
  .gallery-grid {
    @apply grid grid-cols-1 sm:grid-cols-2 gap-6;
  }

  .gallery-item {
    @apply rounded-xl overflow-hidden;
    @apply bg-surface-card border border-line;
    @apply transition-all duration-300;
  }

  .gallery-item:hover {
    @apply -translate-y-1 shadow-xl border-accent/30;
  }

  .gallery-img-container {
    @apply aspect-[4/3] overflow-hidden;
  }

  .gallery-img {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500;
  }

  .gallery-item:hover .gallery-img {
    @apply scale-105;
  }

  .gallery-caption {
    @apply p-4 text-sm text-muted leading-relaxed;
  }

  /* Field Site */
  .field-site-card {
    @apply grid md:grid-cols-2 gap-8 items-center;
    @apply rounded-2xl overflow-hidden;
    @apply bg-surface-card border border-line;
  }

  .field-site-image {
    @apply aspect-[16/10] md:aspect-auto md:h-full overflow-hidden;
  }

  .field-site-image img {
    @apply w-full h-full object-cover;
  }

  .field-site-content {
    @apply p-8;
  }

  .field-site-link {
    @apply flex items-center gap-2 no-underline;
  }

  .field-site-link:hover .field-site-name,
  .field-site-link:hover .field-site-external-icon {
    @apply text-accent;
  }

  .field-site-name {
    @apply text-2xl font-bold text-ink mt-2 mb-1;
    @apply transition-colors;
  }

  .field-site-external-icon {
    @apply w-5 h-5 text-muted mt-2;
    @apply transition-colors;
  }

  .field-site-location {
    @apply text-accent font-medium mb-4;
  }

  .field-site-description {
    @apply text-muted leading-relaxed;
  }

  /* ========================================
     Species Silhouette Border Pattern
     ======================================== */
  .species-border {
    @apply relative w-full overflow-hidden;
    height: 80px;
    margin-top: -40px;
    z-index: 20;
  }

  .species-silhouette {
    @apply absolute bottom-0 left-0 w-full;
    height: 100%;
  }

  /* Coral Reef Silhouette */
  .coral-silhouette .silhouette-path {
    fill: rgba(56, 189, 248, 0.15);
    transition: fill 0.5s ease;
  }

  .coral-silhouette:hover .silhouette-path {
    fill: rgba(56, 189, 248, 0.25);
  }

  .coral-silhouette .silhouette-bubble {
    fill: rgba(56, 189, 248, 0.4);
    animation: coral-bubble-float 4s ease-in-out infinite;
  }

  .coral-silhouette .bubble-1 { animation-delay: 0s; }
  .coral-silhouette .bubble-2 { animation-delay: 0.8s; }
  .coral-silhouette .bubble-3 { animation-delay: 1.6s; }
  .coral-silhouette .bubble-4 { animation-delay: 2.4s; }
  .coral-silhouette .bubble-5 { animation-delay: 3.2s; }

  @keyframes coral-bubble-float {
    0%, 100% {
      transform: translateY(0) scale(1);
      opacity: 0.4;
    }
    50% {
      transform: translateY(-8px) scale(1.2);
      opacity: 0.8;
    }
  }

  /* Kelp Forest Silhouette */
  .kelp-silhouette .silhouette-path {
    fill: none;
    stroke: rgba(45, 212, 191, 0.25);
    stroke-width: 8;
    stroke-linecap: round;
    animation: kelp-sway 6s ease-in-out infinite;
    transform-origin: bottom center;
  }

  .kelp-silhouette .frond-1 { animation-delay: 0s; }
  .kelp-silhouette .frond-2 { animation-delay: 0.5s; }
  .kelp-silhouette .frond-3 { animation-delay: 1s; }
  .kelp-silhouette .frond-4 { animation-delay: 1.5s; }
  .kelp-silhouette .frond-5 { animation-delay: 2s; }
  .kelp-silhouette .frond-6 { animation-delay: 2.5s; }
  .kelp-silhouette .frond-7 { animation-delay: 3s; }
  .kelp-silhouette .frond-8 { animation-delay: 3.5s; }

  @keyframes kelp-sway {
    0%, 100% {
      transform: rotate(-3deg);
    }
    50% {
      transform: rotate(3deg);
    }
  }

  .kelp-silhouette .kelp-bladder {
    fill: rgba(45, 212, 191, 0.35);
    animation: bladder-bob 3s ease-in-out infinite;
  }

  .kelp-silhouette .bladder-1 { animation-delay: 0s; }
  .kelp-silhouette .bladder-2 { animation-delay: 0.4s; }
  .kelp-silhouette .bladder-3 { animation-delay: 0.8s; }
  .kelp-silhouette .bladder-4 { animation-delay: 1.2s; }
  .kelp-silhouette .bladder-5 { animation-delay: 1.6s; }
  .kelp-silhouette .bladder-6 { animation-delay: 2s; }
  .kelp-silhouette .bladder-7 { animation-delay: 2.4s; }
  .kelp-silhouette .bladder-8 { animation-delay: 2.8s; }

  @keyframes bladder-bob {
    0%, 100% {
      transform: translateY(0) scale(1);
      opacity: 0.35;
    }
    50% {
      transform: translateY(-3px) scale(1.1);
      opacity: 0.6;
    }
  }

  /* Reduced motion for species border */
  @media (prefers-reduced-motion: reduce) {
    .coral-silhouette .silhouette-bubble,
    .kelp-silhouette .silhouette-path,
    .kelp-silhouette .kelp-bladder {
      animation: none;
    }
  }
</style>

<script>
  // Parallax effect
  const initParallax = () => {
    const parallaxBg = document.querySelector('.parallax-bg') as HTMLElement;
    if (!parallaxBg) return;

    const handleScroll = () => {
      const scrolled = window.scrollY;
      const rate = scrolled * 0.3;
      parallaxBg.style.transform = `translateY(${rate}px)`;
    };

    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      window.addEventListener('scroll', handleScroll, { passive: true });
    }
  };

  // Tap-to-flip for finding cards on mobile
  const initFlipCards = () => {
    const isMobile = window.innerWidth < 768;
    const cards = document.querySelectorAll('.finding-card');

    cards.forEach((card) => {
      card.addEventListener('click', () => {
        if (isMobile) {
          card.classList.toggle('flipped');
        }
      });
    });
  };

  initParallax();
  initFlipCards();
  document.addEventListener('astro:after-swap', () => {
    initParallax();
    initFlipCards();
  });
</script>
