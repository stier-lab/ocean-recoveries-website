---
import Layout from '@layouts/Layout.astro';
import Breadcrumbs from '@components/layout/Breadcrumbs.astro';
import BreadcrumbSchema from '@components/seo/BreadcrumbSchema.astro';
import { researchThemes } from '@data/research';
import { publications } from '@data/publications';
import { posts } from '@data/posts';
import { enrichPublicationsWithImages } from '@utils/publicationImages';

export function getStaticPaths() {
  return researchThemes.map((theme) => ({
    params: { slug: theme.slug },
    props: { theme },
  }));
}

const { theme } = Astro.props;

// Enrich publications with news post data
const enrichedPubs = enrichPublicationsWithImages(publications, posts);

// Map slug to publication theme and related keywords
const themeToPublicationMap: Record<string, string> = {
  'coral-reefs': 'Coral',
  'kelp-forests': 'Kelp',
};

// Keywords for filtering news posts
const themeToNewsKeywords: Record<string, string[]> = {
  'coral-reefs': ['coral', 'reef', 'bleaching', 'crab', 'damselfish', 'moorea', 'trapezia', 'guard crab', 'crown-of-thorns', 'corallivory'],
  'kelp-forests': ['kelp', 'lobster', 'urchin', 'barren', 'california', 'mpa', 'spillover', 'detritus', 'sheephead'],
};

const publicationTheme = themeToPublicationMap[theme.slug] || theme.title;
const newsKeywords = themeToNewsKeywords[theme.slug] || [theme.title.toLowerCase()];

// Get related publications (matching theme, sorted by year and citations)
const relatedPubs = enrichedPubs
  .filter(pub => pub.themes.some(t => t.toLowerCase().includes(publicationTheme.toLowerCase())))
  .sort((a, b) => b.year - a.year || (b.citationCount || 0) - (a.citationCount || 0))
  .slice(0, 6);

// Get related news posts (matching keywords in title, excerpt, or tags)
const relatedNews = posts
  .filter(post => {
    const searchText = `${post.title} ${post.excerpt} ${post.tags.join(' ')}`.toLowerCase();
    return newsKeywords.some(keyword => searchText.includes(keyword.toLowerCase()));
  })
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);

const breadcrumbs = [
  { label: 'Research', href: '/research' },
  { label: theme.title },
];

// Theme-specific colors
const isCoral = theme.slug === 'coral-reefs';
---

<Layout
  title={theme.title}
  description={theme.tagline}
  image={theme.heroImage}
  keywords={[theme.title, 'marine ecology', 'ocean research', 'UCSB', 'marine conservation']}
>
  <!-- SEO Structured Data -->
  <BreadcrumbSchema
    items={[
      { name: 'Research', url: '/research' },
      { name: theme.title, url: `/research/${theme.slug}` }
    ]}
  />

  <!-- ============================================
       HERO SECTION - Cinematic Full Viewport
       ============================================ -->
  <section class="hero-section">
    <!-- Background Media -->
    <div class="hero-media">
      <img
        src={theme.heroImage}
        alt=""
        class="hero-image"
        loading="eager"
      />
      <div class="hero-overlay"></div>
      <div class="hero-vignette"></div>
    </div>

    <!-- Floating Particles -->
    <div class="hero-particles" aria-hidden="true">
      <div class="particle particle-1"></div>
      <div class="particle particle-2"></div>
      <div class="particle particle-3"></div>
      <div class="particle particle-4"></div>
      <div class="particle particle-5"></div>
      <div class="particle particle-6"></div>
    </div>

    <!-- Hero Content -->
    <div class="hero-content">
      <div class="container">
        <Breadcrumbs items={breadcrumbs} class="hero-breadcrumbs" />

        <h1 class="hero-title">
          <span class={`hero-title-gradient ${isCoral ? 'coral-gradient' : 'kelp-gradient'}`}>
            {theme.title}
          </span>
        </h1>

        <p class="hero-tagline">{theme.tagline}</p>

        <!-- Quick Stats -->
        <div class="hero-stats">
          <div class="hero-stat">
            <span class="hero-stat-value">{theme.questions.length}</span>
            <span class="hero-stat-label">Key Questions</span>
          </div>
          <div class="hero-stat-divider"></div>
          <div class="hero-stat">
            <span class="hero-stat-value">{theme.findings.length}</span>
            <span class="hero-stat-label">Discoveries</span>
          </div>
          <div class="hero-stat-divider"></div>
          <div class="hero-stat">
            <span class="hero-stat-value">{relatedPubs.length}+</span>
            <span class="hero-stat-label">Publications</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator" aria-hidden="true">
      <div class="scroll-line"></div>
      <span class="scroll-text">Explore</span>
    </div>
  </section>

  <!-- Wave Divider -->
  <div class="wave-divider" aria-hidden="true">
    <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
      <path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25"></path>
      <path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5"></path>
      <path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"></path>
    </svg>
  </div>

  <!-- ============================================
       OVERVIEW SECTION
       ============================================ -->
  <section class="section-overview">
    <div class="container">
      <div class="overview-content scroll-reveal">
        <div class="overview-eyebrow">
          <span class={`eyebrow-icon ${isCoral ? 'coral-icon' : 'kelp-icon'}`}>
            {isCoral ? (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            ) : (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
              </svg>
            )}
          </span>
          <span class="eyebrow-text">Overview</span>
        </div>

        <div class="overview-text">
          {theme.description.split('\n\n').map((paragraph) => (
            <p>{paragraph}</p>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================
       KEY QUESTIONS SECTION
       ============================================ -->
  <section class="section-questions">
    <div class="questions-bg" aria-hidden="true">
      <div class={`questions-orb questions-orb-1 ${isCoral ? 'coral-orb' : 'kelp-orb'}`}></div>
      <div class={`questions-orb questions-orb-2 ${isCoral ? 'coral-orb' : 'kelp-orb'}`}></div>
    </div>

    <div class="container relative z-10">
      <div class="section-header scroll-reveal">
        <span class="section-eyebrow">Research Focus</span>
        <h2 class="section-title">Key <span class="title-gradient">Questions</span></h2>
        <p class="section-desc">
          The driving inquiries that guide our research in {theme.title.toLowerCase()}.
        </p>
      </div>

      <div class="questions-grid">
        {theme.questions.map((question, i) => (
          <div class={`question-card scroll-reveal stagger-${i + 1}`}>
            <div class={`question-number ${isCoral ? 'coral-number' : 'kelp-number'}`}>
              <span>{String(i + 1).padStart(2, '0')}</span>
            </div>
            <div class="question-content">
              <p class="question-text">{question}</p>
            </div>
            <div class={`question-accent ${isCoral ? 'coral-accent' : 'kelp-accent'}`}></div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- ============================================
       KEY FINDINGS SECTION
       ============================================ -->
  <section class="section-findings">
    <div class="container">
      <div class="section-header scroll-reveal">
        <span class="section-eyebrow">Discoveries</span>
        <h2 class="section-title">Key <span class="title-gradient">Findings</span></h2>
        <p class="section-desc">
          Breakthrough insights from our research.
          <span class="text-sm block mt-2 text-muted/60 md:hidden">Tap cards to reveal details</span>
        </p>
      </div>

      <div class="findings-grid">
        {theme.findings.map((finding, i) => (
          <button
            type="button"
            class={`finding-card scroll-reveal stagger-${i + 1}`}
            aria-label={`${finding.title}. Tap to reveal details.`}
          >
            <div class="finding-front">
              <div class={`finding-icon ${isCoral ? 'coral-finding-icon' : 'kelp-finding-icon'}`}>
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
              </div>
              <h3 class="finding-title">{finding.title}</h3>
              <p class="finding-summary">{finding.summary}</p>
              <span class="finding-hint hidden md:flex">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
                Hover for details
              </span>
              <span class="finding-hint md:hidden">Tap for details</span>
            </div>
            <div class={`finding-back ${isCoral ? 'coral-finding-back' : 'kelp-finding-back'}`}>
              <p class="finding-detail">{finding.detail}</p>
              <span class="finding-hint md:hidden mt-4">Tap to go back</span>
            </div>
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- ============================================
       PHOTO GALLERY SECTION
       ============================================ -->
  {theme.gallery && theme.gallery.length > 0 && (
    <section class="section-gallery">
      <div class="gallery-bg" aria-hidden="true"></div>

      <div class="container relative z-10">
        <div class="section-header scroll-reveal">
          <span class="section-eyebrow">From the Field</span>
          <h2 class="section-title">Photo <span class="title-gradient">Gallery</span></h2>
        </div>

        <div class="gallery-grid">
          {theme.gallery.map((image, i) => (
            <figure class={`gallery-item scroll-reveal stagger-${(i % 4) + 1} ${i === 0 ? 'gallery-featured' : ''}`}>
              <div class="gallery-img-container">
                <img
                  src={image.src}
                  alt={image.alt}
                  loading="lazy"
                  class="gallery-img"
                />
                <div class="gallery-overlay"></div>
              </div>
              {image.caption && (
                <figcaption class="gallery-caption">
                  <span class={`gallery-caption-icon ${isCoral ? 'coral-icon' : 'kelp-icon'}`}>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </span>
                  {image.caption}
                </figcaption>
              )}
            </figure>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- ============================================
       FIELD SITE SECTION
       ============================================ -->
  {theme.fieldSite && (
    <section class="section-fieldsite">
      <div class="container">
        <div class="fieldsite-card scroll-reveal">
          <div class="fieldsite-image">
            <img
              src={theme.fieldSite.image}
              alt={theme.fieldSite.name}
              loading="lazy"
            />
            <div class="fieldsite-image-overlay"></div>

            <!-- Location Pin -->
            <div class={`fieldsite-pin ${isCoral ? 'coral-pin' : 'kelp-pin'}`}>
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
          </div>

          <div class="fieldsite-content">
            <span class="section-eyebrow">Field Site</span>

            {theme.fieldSite.url ? (
              <a href={theme.fieldSite.url} target="_blank" rel="noopener noreferrer" class="fieldsite-link">
                <h3 class="fieldsite-name">{theme.fieldSite.name}</h3>
                <svg class="fieldsite-external" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              </a>
            ) : (
              <h3 class="fieldsite-name">{theme.fieldSite.name}</h3>
            )}

            <p class={`fieldsite-location ${isCoral ? 'coral-location' : 'kelp-location'}`}>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              {theme.fieldSite.location}
            </p>

            <p class="fieldsite-description">{theme.fieldSite.description}</p>

            {theme.fieldSite.url && (
              <a href={theme.fieldSite.url} target="_blank" rel="noopener noreferrer" class={`fieldsite-btn ${isCoral ? 'coral-btn' : 'kelp-btn'}`}>
                <span>Visit LTER Site</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </a>
            )}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- ============================================
       RELATED PUBLICATIONS SECTION
       ============================================ -->
  {relatedPubs.length > 0 && (
    <section class="section-publications">
      <div class="publications-bg" aria-hidden="true">
        <div class={`publications-orb ${isCoral ? 'coral-orb' : 'kelp-orb'}`}></div>
      </div>

      <div class="container relative z-10">
        <div class="section-header scroll-reveal">
          <span class="section-eyebrow">Featured Research</span>
          <h2 class="section-title">Related <span class="title-gradient">Publications</span></h2>
        </div>

        <div class="publications-grid">
          {relatedPubs.map((pub, i) => (
            <article class={`pub-card scroll-reveal stagger-${(i % 3) + 1}`}>
              {pub.image && (
                <div class="pub-image">
                  <img src={pub.image} alt="" loading="lazy" />
                  <div class="pub-image-overlay"></div>
                  <div class={`pub-year-badge ${isCoral ? 'coral-badge' : 'kelp-badge'}`}>{pub.year}</div>
                </div>
              )}
              <div class="pub-content">
                <h3 class="pub-title">{pub.title}</h3>
                <p class="pub-authors">{pub.authors.split(',').slice(0, 3).join(', ')}{pub.authors.split(',').length > 3 ? ' et al.' : ''}</p>
                <div class="pub-meta">
                  <span class="pub-journal">{pub.journal}</span>
                  {pub.citationCount && pub.citationCount > 0 && (
                    <span class="pub-citations">
                      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                      </svg>
                      {pub.citationCount}
                    </span>
                  )}
                </div>
                <div class="pub-links">
                  {pub.newsSlug && (
                    <a href={`/news/${pub.newsSlug}`} class={`pub-link pub-link-news ${isCoral ? 'coral-link' : 'kelp-link'}`}>
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                      </svg>
                      Read Summary
                    </a>
                  )}
                  {pub.doi && (
                    <a
                      href={`https://doi.org/${pub.doi}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="pub-link"
                    >
                      View Paper
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                      </svg>
                    </a>
                  )}
                </div>
              </div>
            </article>
          ))}
        </div>

        <div class="text-center mt-12 scroll-reveal">
          <a href="/publications" class="btn-view-all">
            <span>View All Publications</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </div>
    </section>
  )}

  <!-- ============================================
       RELATED NEWS SECTION
       ============================================ -->
  {relatedNews.length > 0 && (
    <section class="section-news">
      <div class="container">
        <div class="section-header scroll-reveal">
          <span class="section-eyebrow">Latest Stories</span>
          <h2 class="section-title">Related <span class="title-gradient">News</span></h2>
          <p class="section-desc">
            Read accessible summaries of our latest research in {theme.title.toLowerCase()}.
          </p>
        </div>

        <div class="news-grid">
          {relatedNews.map((post, i) => (
            <a href={`/news/${post.slug}`} class={`news-card scroll-reveal stagger-${(i % 3) + 1}`}>
              <div class="news-image">
                <img src={post.featuredImage} alt="" loading="lazy" />
                <div class="news-image-overlay"></div>
                <div class={`news-date-badge ${isCoral ? 'coral-badge' : 'kelp-badge'}`}>
                  {new Date(post.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                </div>
              </div>
              <div class="news-content">
                <h3 class="news-title">{post.title}</h3>
                <p class="news-excerpt">{post.excerpt.slice(0, 120)}...</p>
                <span class={`news-read-more ${isCoral ? 'coral-link' : 'kelp-link'}`}>
                  Read More
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </span>
              </div>
            </a>
          ))}
        </div>

        <div class="text-center mt-12 scroll-reveal">
          <a href="/news" class="btn-view-all">
            <span>View All News</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </div>
    </section>
  )}

  <!-- ============================================
       CTA SECTION
       ============================================ -->
  <section class="section-cta">
    <div class="cta-bg" aria-hidden="true">
      <div class={`cta-orb cta-orb-1 ${isCoral ? 'coral-orb' : 'kelp-orb'}`}></div>
      <div class={`cta-orb cta-orb-2 ${isCoral ? 'coral-orb' : 'kelp-orb'}`}></div>
    </div>

    <div class="container relative z-10">
      <div class="cta-card scroll-reveal">
        <div class="cta-content">
          <h2 class="cta-title">Want to Learn More?</h2>
          <p class="cta-text">
            Explore our other research areas or get in touch to discuss potential collaborations.
          </p>
        </div>
        <div class="cta-actions">
          <a href="/research" class="btn-primary">
            <span>All Research Areas</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
          <a href="/join" class="btn-secondary">
            <span>Join the Lab</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* ============================================
     HERO SECTION
     ============================================ */
  .hero-section {
    @apply relative min-h-screen flex items-center justify-center;
    @apply overflow-hidden;
  }

  .hero-media {
    @apply absolute inset-0;
  }

  .hero-image {
    @apply w-full h-full object-cover;
    transform: scale(1.05);
    animation: heroZoom 20s ease-out forwards;
  }

  @keyframes heroZoom {
    from { transform: scale(1.1); }
    to { transform: scale(1); }
  }

  .hero-overlay {
    @apply absolute inset-0;
    background: linear-gradient(
      180deg,
      rgba(15, 23, 42, 0.4) 0%,
      rgba(15, 23, 42, 0.3) 40%,
      rgba(15, 23, 42, 0.7) 70%,
      rgba(15, 23, 42, 0.95) 100%
    );
  }

  .hero-vignette {
    @apply absolute inset-0;
    background: radial-gradient(ellipse at center, transparent 0%, rgba(15, 23, 42, 0.4) 100%);
  }

  /* Particles */
  .hero-particles {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
  }

  .particle {
    @apply absolute rounded-full;
    background: radial-gradient(circle, rgba(56, 189, 248, 0.6) 0%, transparent 70%);
    animation: particleFloat linear infinite;
  }

  .particle-1 { width: 4px; height: 4px; left: 10%; animation-duration: 15s; }
  .particle-2 { width: 6px; height: 6px; left: 25%; animation-duration: 18s; animation-delay: 2s; }
  .particle-3 { width: 3px; height: 3px; left: 45%; animation-duration: 12s; animation-delay: 4s; }
  .particle-4 { width: 5px; height: 5px; left: 60%; animation-duration: 20s; animation-delay: 1s; }
  .particle-5 { width: 4px; height: 4px; left: 75%; animation-duration: 16s; animation-delay: 3s; }
  .particle-6 { width: 3px; height: 3px; left: 90%; animation-duration: 14s; animation-delay: 5s; }

  @keyframes particleFloat {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: 0.8; }
    90% { opacity: 0.8; }
    100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
  }

  /* Hero Content */
  .hero-content {
    @apply relative z-10 text-center;
    @apply pt-32 pb-24;
  }

  .hero-breadcrumbs {
    @apply mb-8;
    animation: fadeUp 0.8s ease-out forwards;
    opacity: 0;
  }

  .hero-title {
    @apply text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-black;
    @apply mb-6;
    animation: fadeUp 0.8s ease-out 0.1s forwards;
    opacity: 0;
  }

  .hero-title-gradient {
    display: inline-block;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 200% 200%;
    animation: gradientShift 8s ease-in-out infinite;
  }

  .coral-gradient {
    background-image: linear-gradient(135deg, #fff 0%, #fb923c 30%, #f43f5e 60%, #fb923c 100%);
  }

  .kelp-gradient {
    background-image: linear-gradient(135deg, #fff 0%, #34d399 30%, #2dd4bf 60%, #34d399 100%);
  }

  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .hero-tagline {
    @apply text-xl md:text-2xl text-white/80 max-w-3xl mx-auto;
    @apply leading-relaxed;
    animation: fadeUp 0.8s ease-out 0.2s forwards;
    opacity: 0;
  }

  .hero-stats {
    @apply flex items-center justify-center gap-6 md:gap-10 mt-10;
    animation: fadeUp 0.8s ease-out 0.3s forwards;
    opacity: 0;
  }

  .hero-stat {
    @apply text-center;
  }

  .hero-stat-value {
    @apply block text-3xl md:text-4xl font-black text-white;
  }

  .hero-stat-label {
    @apply block text-sm text-white/60 uppercase tracking-wider mt-1;
  }

  .hero-stat-divider {
    @apply w-px h-12 bg-white/20;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Scroll Indicator */
  .scroll-indicator {
    @apply absolute bottom-8 left-1/2 -translate-x-1/2;
    @apply flex flex-col items-center gap-3;
    animation: fadeUp 0.8s ease-out 0.5s forwards, bounce 2s ease-in-out 1.5s infinite;
    opacity: 0;
  }

  .scroll-line {
    @apply w-px h-12 bg-gradient-to-b from-transparent via-accent to-transparent;
  }

  .scroll-text {
    @apply text-xs text-white/50 uppercase tracking-widest;
  }

  @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(8px); }
  }

  /* Wave Divider */
  .wave-divider {
    @apply relative -mt-1 bg-surface;
  }

  .wave-divider svg {
    @apply block w-full h-16 md:h-24;
    fill: rgb(15, 23, 42);
  }

  /* ============================================
     OVERVIEW SECTION
     ============================================ */
  .section-overview {
    @apply py-20 md:py-28 bg-surface;
  }

  .overview-content {
    @apply max-w-3xl mx-auto;
  }

  .overview-eyebrow {
    @apply flex items-center gap-3 mb-6;
  }

  .eyebrow-icon {
    @apply w-10 h-10 rounded-xl flex items-center justify-center;
  }

  .coral-icon { @apply bg-orange-500/20 text-orange-400; }
  .kelp-icon { @apply bg-teal-500/20 text-teal-400; }

  .eyebrow-text {
    @apply text-sm font-bold uppercase tracking-widest text-muted;
  }

  .overview-text {
    @apply space-y-6;
  }

  .overview-text p {
    @apply text-lg md:text-xl text-muted leading-relaxed;
  }

  /* ============================================
     QUESTIONS SECTION
     ============================================ */
  .section-questions {
    @apply relative py-24 md:py-32 overflow-hidden;
    background: linear-gradient(180deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 1) 100%);
  }

  .questions-bg {
    @apply absolute inset-0 overflow-hidden;
  }

  .questions-orb {
    @apply absolute rounded-full blur-3xl;
    animation: orbFloat 20s ease-in-out infinite;
  }

  .questions-orb-1 {
    @apply w-96 h-96 -top-48 -left-48;
  }

  .questions-orb-2 {
    @apply w-80 h-80 -bottom-40 -right-40;
    animation-delay: 5s;
  }

  .coral-orb { background: rgba(251, 146, 60, 0.08); }
  .kelp-orb { background: rgba(45, 212, 191, 0.08); }

  @keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -30px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
  }

  .section-header {
    @apply text-center mb-16;
  }

  .section-eyebrow {
    @apply block text-sm font-bold uppercase tracking-widest text-accent-2 mb-4;
  }

  .section-title {
    @apply text-3xl md:text-4xl lg:text-5xl font-black text-ink mb-4;
  }

  .title-gradient {
    @apply bg-gradient-to-r from-accent to-accent-2 bg-clip-text text-transparent;
  }

  .section-desc {
    @apply text-lg text-muted max-w-2xl mx-auto;
  }

  .questions-grid {
    @apply grid md:grid-cols-2 gap-6 max-w-5xl mx-auto;
  }

  .question-card {
    @apply relative flex gap-5 p-6 rounded-2xl;
    @apply bg-surface-card/50 backdrop-blur-sm;
    @apply border border-line/50;
    transition: all 400ms ease;
  }

  .question-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.4);
  }

  .question-number {
    @apply flex-shrink-0 w-12 h-12 rounded-xl;
    @apply flex items-center justify-center;
    @apply font-black text-lg;
  }

  .coral-number { @apply bg-orange-500/20 text-orange-400; }
  .kelp-number { @apply bg-teal-500/20 text-teal-400; }

  .question-content {
    @apply flex-1;
  }

  .question-text {
    @apply text-ink font-medium leading-relaxed;
  }

  .question-accent {
    @apply absolute bottom-0 left-6 right-6 h-0.5 rounded-full;
    @apply opacity-0;
    transition: opacity 400ms ease;
  }

  .coral-accent { @apply bg-gradient-to-r from-orange-400 to-rose-500; }
  .kelp-accent { @apply bg-gradient-to-r from-emerald-400 to-teal-500; }

  .question-card:hover .question-accent {
    @apply opacity-100;
  }

  /* ============================================
     FINDINGS SECTION
     ============================================ */
  .section-findings {
    @apply py-24 md:py-32 bg-surface;
  }

  .findings-grid {
    @apply grid md:grid-cols-3 gap-6 max-w-6xl mx-auto;
  }

  .finding-card {
    @apply relative h-72 rounded-2xl w-full text-left cursor-pointer;
    perspective: 1000px;
    background: transparent;
    border: none;
    padding: 0;
  }

  .finding-card:focus {
    @apply outline-none ring-2 ring-accent ring-offset-2 ring-offset-surface;
  }

  .finding-front,
  .finding-back {
    @apply absolute inset-0 rounded-2xl p-6;
    @apply flex flex-col;
    backface-visibility: hidden;
    transition: transform 0.6s ease;
  }

  .finding-front {
    @apply bg-surface-card border border-line/50;
  }

  .finding-back {
    @apply justify-center;
    transform: rotateY(180deg);
  }

  .coral-finding-back {
    background: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(244, 63, 94, 0.15) 100%);
    @apply border border-orange-500/30;
  }

  .kelp-finding-back {
    background: linear-gradient(135deg, rgba(52, 211, 153, 0.15) 0%, rgba(45, 212, 191, 0.15) 100%);
    @apply border border-teal-500/30;
  }

  @media (min-width: 768px) {
    .finding-card:hover .finding-front,
    .finding-card:focus .finding-front {
      transform: rotateY(-180deg);
    }

    .finding-card:hover .finding-back,
    .finding-card:focus .finding-back {
      transform: rotateY(0deg);
    }
  }

  @media (max-width: 767px) {
    .finding-card.flipped .finding-front {
      transform: rotateY(-180deg);
    }

    .finding-card.flipped .finding-back {
      transform: rotateY(0deg);
    }
  }

  .finding-icon {
    @apply w-14 h-14 rounded-xl mb-5;
    @apply flex items-center justify-center;
  }

  .coral-finding-icon { @apply bg-orange-500/20 text-orange-400; }
  .kelp-finding-icon { @apply bg-teal-500/20 text-teal-400; }

  .finding-title {
    @apply font-bold text-lg text-ink mb-3;
  }

  .finding-summary {
    @apply text-sm text-muted flex-1 leading-relaxed;
  }

  .finding-hint {
    @apply flex items-center gap-2 text-xs text-accent font-medium mt-3;
  }

  .finding-detail {
    @apply text-sm text-ink leading-relaxed font-medium;
  }

  /* ============================================
     GALLERY SECTION
     ============================================ */
  .section-gallery {
    @apply relative py-24 md:py-32 overflow-hidden;
    background: linear-gradient(180deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 1) 100%);
  }

  .gallery-bg {
    @apply absolute inset-0;
    background: radial-gradient(ellipse at 50% 0%, rgba(56, 189, 248, 0.05) 0%, transparent 60%);
  }

  .gallery-grid {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6;
  }

  .gallery-item {
    @apply rounded-2xl overflow-hidden;
    @apply bg-surface-card border border-line/50;
    transition: all 400ms ease;
  }

  .gallery-featured {
    @apply sm:col-span-2 sm:row-span-2;
  }

  .gallery-item:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
    @apply border-accent/30;
  }

  .gallery-img-container {
    @apply relative aspect-[4/3] overflow-hidden;
  }

  .gallery-featured .gallery-img-container {
    @apply aspect-square;
  }

  .gallery-img {
    @apply w-full h-full object-cover;
    transition: transform 600ms ease;
  }

  .gallery-item:hover .gallery-img {
    transform: scale(1.1);
  }

  .gallery-overlay {
    @apply absolute inset-0;
    background: linear-gradient(180deg, transparent 50%, rgba(15, 23, 42, 0.6) 100%);
    @apply opacity-0;
    transition: opacity 400ms ease;
  }

  .gallery-item:hover .gallery-overlay {
    @apply opacity-100;
  }

  .gallery-caption {
    @apply flex items-start gap-3 p-4 text-sm text-muted leading-relaxed;
  }

  .gallery-caption-icon {
    @apply flex-shrink-0 mt-0.5;
  }

  /* ============================================
     FIELD SITE SECTION
     ============================================ */
  .section-fieldsite {
    @apply py-24 md:py-32 bg-surface;
  }

  .fieldsite-card {
    @apply grid md:grid-cols-2 gap-0 items-stretch;
    @apply rounded-3xl overflow-hidden;
    @apply bg-surface-card border border-line/50;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
  }

  .fieldsite-image {
    @apply relative aspect-[16/10] md:aspect-auto overflow-hidden;
  }

  .fieldsite-image img {
    @apply w-full h-full object-cover;
    transition: transform 600ms ease;
  }

  .fieldsite-card:hover .fieldsite-image img {
    transform: scale(1.05);
  }

  .fieldsite-image-overlay {
    @apply absolute inset-0;
    background: linear-gradient(135deg, transparent 50%, rgba(15, 23, 42, 0.4) 100%);
  }

  .fieldsite-pin {
    @apply absolute top-4 left-4;
    @apply w-12 h-12 rounded-full;
    @apply flex items-center justify-center;
    @apply shadow-lg;
    animation: pinBounce 2s ease-in-out infinite;
  }

  .coral-pin { @apply bg-orange-500 text-white; }
  .kelp-pin { @apply bg-teal-500 text-white; }

  @keyframes pinBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  .fieldsite-content {
    @apply p-8 md:p-10 flex flex-col justify-center;
  }

  .fieldsite-link {
    @apply flex items-center gap-2 no-underline;
  }

  .fieldsite-name {
    @apply text-2xl md:text-3xl font-black text-ink mt-2 mb-2;
    transition: color 300ms ease;
  }

  .fieldsite-link:hover .fieldsite-name {
    @apply text-accent;
  }

  .fieldsite-external {
    @apply w-5 h-5 text-muted mt-2;
    transition: all 300ms ease;
  }

  .fieldsite-link:hover .fieldsite-external {
    @apply text-accent;
    transform: translate(2px, -2px);
  }

  .fieldsite-location {
    @apply flex items-center gap-2 font-medium mb-4;
  }

  .coral-location { @apply text-orange-400; }
  .kelp-location { @apply text-teal-400; }

  .fieldsite-description {
    @apply text-muted leading-relaxed mb-6;
  }

  .fieldsite-btn {
    @apply inline-flex items-center gap-2 px-6 py-3;
    @apply rounded-xl font-bold text-sm;
    @apply no-underline;
    transition: all 300ms ease;
  }

  .coral-btn {
    @apply bg-orange-500/20 text-orange-400 border border-orange-500/30;
  }

  .coral-btn:hover {
    @apply bg-orange-500 text-white border-orange-500;
  }

  .kelp-btn {
    @apply bg-teal-500/20 text-teal-400 border border-teal-500/30;
  }

  .kelp-btn:hover {
    @apply bg-teal-500 text-white border-teal-500;
  }

  /* ============================================
     PUBLICATIONS SECTION
     ============================================ */
  .section-publications {
    @apply relative py-24 md:py-32 overflow-hidden;
    background: linear-gradient(180deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 1) 100%);
  }

  .publications-bg {
    @apply absolute inset-0 overflow-hidden;
  }

  .publications-orb {
    @apply absolute w-[600px] h-[600px] rounded-full blur-3xl;
    @apply top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2;
    animation: orbFloat 25s ease-in-out infinite;
  }

  .publications-grid {
    @apply grid md:grid-cols-2 lg:grid-cols-3 gap-6;
  }

  .pub-card {
    @apply flex flex-col rounded-2xl overflow-hidden;
    @apply bg-surface-card/50 backdrop-blur-sm border border-line/50;
    transition: all 400ms ease;
  }

  .pub-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
    @apply border-accent/30;
  }

  .pub-image {
    @apply relative aspect-[16/9] overflow-hidden;
  }

  .pub-image img {
    @apply w-full h-full object-cover;
    transition: transform 600ms ease;
  }

  .pub-card:hover .pub-image img {
    transform: scale(1.1);
  }

  .pub-image-overlay {
    @apply absolute inset-0;
    background: linear-gradient(180deg, transparent 50%, rgba(15, 23, 42, 0.6) 100%);
  }

  .pub-year-badge {
    @apply absolute top-3 left-3;
    @apply px-3 py-1 rounded-full;
    @apply text-xs font-bold text-white;
  }

  .coral-badge { @apply bg-orange-500; }
  .kelp-badge { @apply bg-teal-500; }

  .pub-content {
    @apply flex flex-col flex-1 p-5;
  }

  .pub-title {
    @apply text-base font-bold text-ink mb-2 line-clamp-3;
  }

  .pub-authors {
    @apply text-sm text-muted mb-3 line-clamp-1;
  }

  .pub-meta {
    @apply flex items-center gap-3 text-xs text-muted/70 mb-4;
  }

  .pub-journal {
    @apply italic;
  }

  .pub-citations {
    @apply flex items-center gap-1;
  }

  .pub-links {
    @apply flex flex-wrap items-center gap-3;
    @apply mt-auto pt-4 border-t border-line/50;
  }

  .pub-link {
    @apply inline-flex items-center gap-1.5 text-sm font-medium;
    @apply text-accent hover:text-accent-2 no-underline;
    transition: color 200ms ease;
  }

  .pub-link-news.coral-link { @apply text-orange-400 hover:text-orange-300; }
  .pub-link-news.kelp-link { @apply text-teal-400 hover:text-teal-300; }

  .btn-view-all {
    @apply inline-flex items-center gap-3 px-8 py-4;
    @apply rounded-xl font-bold;
    @apply bg-accent/10 text-accent border border-accent/30;
    @apply no-underline;
    transition: all 300ms ease;
  }

  .btn-view-all:hover {
    @apply bg-accent text-white border-accent;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
  }

  /* ============================================
     NEWS SECTION
     ============================================ */
  .section-news {
    @apply py-24 md:py-32 bg-surface;
  }

  .news-grid {
    @apply grid md:grid-cols-2 lg:grid-cols-3 gap-6;
  }

  .news-card {
    @apply flex flex-col rounded-2xl overflow-hidden;
    @apply bg-surface-card/50 backdrop-blur-sm border border-line/50;
    @apply no-underline;
    transition: all 400ms ease;
  }

  .news-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
    @apply border-accent/30;
  }

  .news-image {
    @apply relative aspect-[16/9] overflow-hidden;
  }

  .news-image img {
    @apply w-full h-full object-cover;
    transition: transform 600ms ease;
  }

  .news-card:hover .news-image img {
    transform: scale(1.1);
  }

  .news-image-overlay {
    @apply absolute inset-0;
    background: linear-gradient(180deg, transparent 50%, rgba(15, 23, 42, 0.6) 100%);
  }

  .news-date-badge {
    @apply absolute top-3 left-3;
    @apply px-3 py-1 rounded-full;
    @apply text-xs font-bold text-white;
  }

  .news-content {
    @apply flex flex-col flex-1 p-5;
  }

  .news-title {
    @apply text-base font-bold text-ink mb-2 line-clamp-2;
  }

  .news-excerpt {
    @apply text-sm text-muted mb-4 line-clamp-2 flex-1;
  }

  .news-read-more {
    @apply inline-flex items-center gap-1.5 text-sm font-medium;
    transition: all 200ms ease;
  }

  .news-read-more.coral-link { @apply text-orange-400; }
  .news-read-more.kelp-link { @apply text-teal-400; }

  .news-card:hover .news-read-more.coral-link { @apply text-orange-300; }
  .news-card:hover .news-read-more.kelp-link { @apply text-teal-300; }

  .news-card:hover .news-read-more svg {
    transform: translateX(4px);
  }

  .news-read-more svg {
    transition: transform 200ms ease;
  }

  /* ============================================
     CTA SECTION
     ============================================ */
  .section-cta {
    @apply relative py-24 md:py-32 overflow-hidden bg-surface;
  }

  .cta-bg {
    @apply absolute inset-0 overflow-hidden;
  }

  .cta-orb {
    @apply absolute rounded-full blur-3xl;
    animation: orbFloat 20s ease-in-out infinite;
  }

  .cta-orb-1 {
    @apply w-80 h-80 -top-40 -left-40;
  }

  .cta-orb-2 {
    @apply w-96 h-96 -bottom-48 -right-48;
    animation-delay: 7s;
  }

  .cta-card {
    @apply relative p-10 md:p-14 rounded-3xl;
    @apply text-center;
    @apply border border-line/50;
    background: linear-gradient(135deg, rgba(30, 41, 59, 0.6) 0%, rgba(30, 41, 59, 0.3) 100%);
    backdrop-filter: blur(20px);
  }

  .cta-title {
    @apply text-3xl md:text-4xl font-black text-white mb-4;
  }

  .cta-text {
    @apply text-lg text-white/70 max-w-xl mx-auto mb-8;
  }

  .cta-actions {
    @apply flex flex-wrap justify-center gap-4;
  }

  .btn-primary {
    @apply inline-flex items-center gap-2 px-6 py-3;
    @apply rounded-xl font-bold text-white;
    @apply bg-accent no-underline;
    transition: all 300ms ease;
  }

  .btn-primary:hover {
    @apply bg-accent/90;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
  }

  .btn-secondary {
    @apply inline-flex items-center gap-2 px-6 py-3;
    @apply rounded-xl font-bold;
    @apply bg-transparent text-ink border border-line;
    @apply no-underline;
    transition: all 300ms ease;
  }

  .btn-secondary:hover {
    @apply border-accent text-accent;
  }

  /* ============================================
     REDUCED MOTION
     ============================================ */
  @media (prefers-reduced-motion: reduce) {
    .hero-image,
    .particle,
    .questions-orb,
    .publications-orb,
    .cta-orb,
    .fieldsite-pin {
      animation: none;
    }

    .hero-image {
      transform: scale(1);
    }

    .hero-breadcrumbs,
    .hero-title,
    .hero-tagline,
    .hero-stats,
    .scroll-indicator {
      animation: none;
      opacity: 1;
    }

    .finding-front,
    .finding-back {
      transition: none;
    }
  }
</style>

<script>
  // Tap-to-flip for finding cards on mobile
  const initFlipCards = () => {
    const isMobile = window.innerWidth < 768;
    const cards = document.querySelectorAll('.finding-card');

    cards.forEach((card) => {
      card.addEventListener('click', () => {
        if (isMobile) {
          card.classList.toggle('flipped');
        }
      });
    });
  };

  initFlipCards();
  document.addEventListener('astro:after-swap', initFlipCards);
</script>
