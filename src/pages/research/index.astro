---
import Layout from '@layouts/Layout.astro';
import Breadcrumbs from '@components/layout/Breadcrumbs.astro';
import WaveDivider from '@components/shared/WaveDivider.astro';
import ResearchGlobe from '@components/research/ResearchGlobe';
import { studySystems, researchPillars } from '@data/research';

const breadcrumbs = [
  { label: 'Research' },
];
---

<Layout
  title="Research"
  description="Ocean Recoveries Lab research: understanding, restoring, and scaling ocean resilience through ecosystem dynamics, conservation science, and quantitative methods."
>
  <!-- Hero -->
  <section class="hero-section relative min-h-[70vh] md:min-h-[80vh] flex items-center overflow-hidden">
    <div
      class="absolute inset-0 bg-cover bg-center parallax-bg"
      style="background-image: url('/images/blacktip-reef-sharks-split-view-island.jpeg');"
    >
      <div class="absolute inset-0 bg-gradient-to-b from-navy-deep/30 via-navy-deep/20 to-navy-deep/90 md:from-navy-deep/50 md:via-navy-deep/40 md:to-navy-deep/95"></div>
      <div class="absolute inset-0" style="background: radial-gradient(ellipse at center, transparent 0%, rgba(11, 37, 69, 0.3) 100%);"></div>
    </div>

    <!-- Floating Bubbles -->
    <div class="floating-bubbles" aria-hidden="true">
      <div class="bubble bubble-1"></div>
      <div class="bubble bubble-2"></div>
      <div class="bubble bubble-3"></div>
      <div class="bubble bubble-4"></div>
      <div class="bubble bubble-5"></div>
      <div class="bubble bubble-6"></div>
      <div class="bubble bubble-7"></div>
      <div class="bubble bubble-8"></div>
    </div>

    <div class="relative z-10 container text-center px-4 pt-24 pb-20 md:pt-32 md:pb-28">
      <Breadcrumbs items={breadcrumbs} class="justify-center mb-6 opacity-0 animate-fade-down" />

      <div class="hero-badge inline-flex items-center gap-2.5 px-4 py-2 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 mb-6">
        <span class="w-2 h-2 rounded-full bg-accent-2 animate-pulse"></span>
        <span class="text-sm font-medium text-white/90 tracking-wide">Our Research</span>
      </div>

      <h1 class="hero-title mb-6">
        <span class="gradient-text">Understanding, Restoring & Scaling</span>
        <span class="text-white block">Ocean Resilience</span>
      </h1>

      <p class="hero-description text-lg md:text-xl text-white/70 max-w-3xl mx-auto mb-12 leading-relaxed">
        <span class="text-reveal-word">We</span>
        <span class="text-reveal-word">integrate</span>
        <span class="text-reveal-word">ecological</span>
        <span class="text-reveal-word">theory,</span>
        <span class="text-reveal-word">quantitative</span>
        <span class="text-reveal-word">methods,</span>
        <span class="text-reveal-word">and</span>
        <span class="text-reveal-word">field</span>
        <span class="text-reveal-word">studies</span>
        <span class="text-reveal-word">with</span>
        <span class="text-reveal-word">a</span>
        <span class="text-reveal-word">commitment</span>
        <span class="text-reveal-word">to</span>
        <span class="text-reveal-word highlight-word">open</span>
        <span class="text-reveal-word highlight-word">science</span>
        <span class="text-reveal-word">and</span>
        <span class="text-reveal-word highlight-word">decision</span>
        <span class="text-reveal-word highlight-word">support</span>
        <span class="text-reveal-word">—</span>
        <span class="text-reveal-word">moving</span>
        <span class="text-reveal-word">insights</span>
        <span class="text-reveal-word">from</span>
        <span class="text-reveal-word">lab</span>
        <span class="text-reveal-word">and</span>
        <span class="text-reveal-word">field</span>
        <span class="text-reveal-word">to</span>
        <span class="text-reveal-word">classrooms,</span>
        <span class="text-reveal-word">observatories,</span>
        <span class="text-reveal-word">and</span>
        <span class="text-reveal-word">coastal</span>
        <span class="text-reveal-word">decision</span>
        <span class="text-reveal-word">tables.</span>
      </p>

      <!-- Quick navigation -->
      <nav class="jump-nav flex flex-wrap justify-center gap-3" aria-label="Jump to section">
        <a href="#pillars" class="jump-link group" data-section="pillars">
          <span>Research Pillars</span>
          <svg class="w-3.5 h-3.5 opacity-0 -translate-x-1 group-hover:opacity-100 group-hover:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
        <a href="#impact" class="jump-link group" data-section="impact">
          <span>Impact Pathway</span>
          <svg class="w-3.5 h-3.5 opacity-0 -translate-x-1 group-hover:opacity-100 group-hover:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
        <a href="#systems" class="jump-link group" data-section="systems">
          <span>Study Systems</span>
          <svg class="w-3.5 h-3.5 opacity-0 -translate-x-1 group-hover:opacity-100 group-hover:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
        <a href="#sites" class="jump-link group" data-section="sites">
          <span>Field Sites</span>
          <svg class="w-3.5 h-3.5 opacity-0 -translate-x-1 group-hover:opacity-100 group-hover:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
      </nav>
    </div>

    <WaveDivider id="hero-wave" fillColor="surface" />
  </section>

  <!-- Three Pillars -->
  <section id="pillars" class="section-lg bg-surface scroll-mt-20 relative overflow-hidden">
    <!-- Animated Blob Shapes -->
    <div class="blob-container" aria-hidden="true">
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
    </div>
    <div class="container relative z-10">
      <div class="text-center mb-14 scroll-reveal">
        <span class="eyebrow">How We Work</span>
        <h2 class="mb-4">Three Research Pillars</h2>
        <p class="lead max-w-3xl mx-auto">
          Our work integrates across three interconnected approaches — from fundamental science to actionable solutions.
        </p>
      </div>

      <div class="pillars-grid">
        {researchPillars.map((pillar, i) => (
          <div class={`pillar-card scroll-reveal stagger-${i + 1}`}>
            {/* Animated equation accent for Quantitative Models pillar */}
            {i === 2 && (
              <div class="equation-accent" aria-hidden="true">
                <span class="eq-term eq-1">dN</span>
                <span class="eq-term eq-2">/</span>
                <span class="eq-term eq-3">dt</span>
                <span class="eq-term eq-4">=</span>
                <span class="eq-term eq-5">rN</span>
                <span class="eq-term eq-6">(1-</span>
                <span class="eq-term eq-7">N/K)</span>
              </div>
            )}
            <div class="pillar-number counter-number" data-target={i + 1}>00</div>
            <div class={`pillar-icon pillar-icon-${i + 1}`}>
              {i === 0 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                </svg>
              )}
              {i === 1 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              )}
              {i === 2 && (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              )}
            </div>
            <h3 class="pillar-title">{pillar.title}</h3>
            <p class="pillar-desc">{pillar.description}</p>
            <ul class="pillar-topics">
              {pillar.topics.map(topic => (
                <li>
                  <svg class="w-3.5 h-3.5 text-accent-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span>{topic}</span>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>

    <WaveDivider id="pillars-wave" fillColor="navy-deep" />
  </section>

  <!-- Impact Pathway -->
  <section id="impact" class="section-lg bg-navy-deep scroll-mt-20 overflow-hidden relative">
    <div class="container">
      <div class="text-center mb-14 scroll-reveal">
        <span class="eyebrow text-accent">From Questions to Action</span>
        <h2 class="text-white mb-4">Our Impact Pathway</h2>
        <p class="text-white/60 max-w-2xl mx-auto text-lg">
          Research flows through four connected stages, each building on the last to create real-world impact.
        </p>
      </div>

      <!-- Desktop Diagram -->
      <div class="pipeline-diagram hidden md:block scroll-reveal" id="pipeline-diagram">
        <svg class="pipeline-svg" viewBox="0 0 1000 300" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
          <defs>
            <linearGradient id="lineGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#38bdf8" stop-opacity="0.3" />
              <stop offset="50%" stop-color="#2dd4bf" stop-opacity="0.6" />
              <stop offset="100%" stop-color="#38bdf8" stop-opacity="0.3" />
            </linearGradient>
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="3" result="blur" />
              <feMerge>
                <feMergeNode in="blur" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>

          <!-- Connection paths -->
          <g class="connections">
            <path id="path1" class="connection-path" d="M 165 120 C 220 60, 280 60, 335 120" />
            <path id="path2" class="connection-path" d="M 415 120 C 470 180, 530 180, 585 120" />
            <path id="path3" class="connection-path" d="M 665 120 C 720 60, 780 60, 835 120" />
          </g>

          <!-- Particles container -->
          <g id="particles"></g>

          <!-- Nodes -->
          <g class="nodes">
            {[
              { cx: 125, label: 'First Principles', desc: 'Fundamental questions', desc2: 'about ecosystem dynamics' },
              { cx: 375, label: 'Quantitative Models', desc: 'Predictive tools and', desc2: 'scenario forecasting' },
              { cx: 625, label: 'Reproducible Data', desc: 'Open science and', desc2: 'shared datasets' },
              { cx: 875, label: 'Tools & Protocols', desc: 'Practical implementation', desc2: 'guides' }
            ].map((node, i) => (
              <g class="node" data-node={i + 1}>
                <circle class="node-glow" cx={node.cx} cy="120" r="52" style={`animation-delay: ${i * 0.4}s`} />
                <circle class="node-ring" cx={node.cx} cy="120" r="44" />
                <circle class="node-core" cx={node.cx} cy="120" r="38" />
                <text class="node-number" x={node.cx} y="128" text-anchor="middle" fill="white" font-size="24" font-weight="800">{i + 1}</text>
              </g>
            ))}
          </g>

          <!-- Labels -->
          <g class="labels">
            <g transform="translate(125, 200)">
              <text class="label-title" x="0" y="0" text-anchor="middle">First Principles</text>
              <text class="label-desc" x="0" y="24" text-anchor="middle">Fundamental questions</text>
              <text class="label-desc" x="0" y="42" text-anchor="middle">about ecosystem dynamics</text>
            </g>
            <g transform="translate(375, 200)">
              <text class="label-title" x="0" y="0" text-anchor="middle">Quantitative Models</text>
              <text class="label-desc" x="0" y="24" text-anchor="middle">Predictive tools and</text>
              <text class="label-desc" x="0" y="42" text-anchor="middle">scenario forecasting</text>
            </g>
            <g transform="translate(625, 200)">
              <text class="label-title" x="0" y="0" text-anchor="middle">Reproducible Data</text>
              <text class="label-desc" x="0" y="24" text-anchor="middle">Open science and</text>
              <text class="label-desc" x="0" y="42" text-anchor="middle">shared datasets</text>
            </g>
            <g transform="translate(875, 200)">
              <text class="label-title" x="0" y="0" text-anchor="middle">Tools & Protocols</text>
              <text class="label-desc" x="0" y="24" text-anchor="middle">Practical implementation</text>
              <text class="label-desc" x="0" y="42" text-anchor="middle">guides</text>
            </g>
          </g>
        </svg>
      </div>

      <!-- Mobile version -->
      <div class="pipeline-mobile md:hidden scroll-reveal">
        <div class="mobile-flow">
          {[
            { icon: 'lightbulb', title: 'First Principles', desc: 'Fundamental questions about ecosystem dynamics' },
            { icon: 'chart', title: 'Quantitative Models', desc: 'Predictive tools and scenario forecasting' },
            { icon: 'database', title: 'Reproducible Data', desc: 'Open science and shared datasets' },
            { icon: 'tools', title: 'Tools & Protocols', desc: 'Practical implementation guides' }
          ].map((step, i) => (
            <>
              <div class={`mobile-step stagger-${i + 1}`}>
                <div class="mobile-node">
                  <span class="mobile-node-number">{i + 1}</span>
                </div>
                <div class="mobile-content">
                  <h4>{step.title}</h4>
                  <p>{step.desc}</p>
                </div>
              </div>
              {i < 3 && (
                <div class="mobile-connector">
                  <div class="mobile-line"></div>
                  <div class="mobile-particle" style={`animation-delay: ${i * 0.3}s`}></div>
                </div>
              )}
            </>
          ))}
        </div>
      </div>
    </div>

    <WaveDivider id="impact-wave" fillColor="surface" />
  </section>

  <!-- Study Systems -->
  <section id="systems" class="section-lg bg-surface scroll-mt-20 relative overflow-hidden">
    <div class="container">
      <div class="text-center mb-14 scroll-reveal">
        <span class="eyebrow">Where We Work</span>
        <h2 class="mb-4">Study Systems</h2>
        <p class="lead max-w-2xl mx-auto">
          Our research focuses on two major marine ecosystems where we conduct long-term field experiments.
        </p>
      </div>

      <div class="systems-grid">
        {studySystems.map((system, i) => (
          <a
            href={`/research/${system.slug}`}
            class={`system-card scroll-reveal stagger-${i + 1} group`}
          >
            <div class="system-card-image">
              <img src={system.heroImage} alt={system.title} loading="lazy" />
              <div class="system-card-overlay"></div>
            </div>
            <div class="system-card-content">
              <div class="system-badge">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>{system.slug === 'coral-reefs' ? 'Moorea, French Polynesia' : 'Santa Barbara, California'}</span>
              </div>
              <h3 class="system-title">{system.title}</h3>
              <p class="system-tagline">{system.tagline}</p>
              <div class="system-link">
                <span>Explore research</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>

    <WaveDivider id="systems-wave" fillColor="navy-deep" />
  </section>

  <!-- Field Sites - Interactive Map -->
  <section id="sites" class="section-lg bg-navy-deep scroll-mt-20 relative overflow-hidden">
    <div class="container">
      <div class="text-center mb-14 scroll-reveal">
        <span class="eyebrow text-accent-2">Our Locations</span>
        <h2 class="text-white mb-4">Field Sites</h2>
        <p class="text-white/60 max-w-2xl mx-auto">
          Research stations across the Pacific and Caribbean where we conduct long-term experiments
          and monitor ecosystem change. Click a site to learn more.
        </p>
      </div>

      <div class="globe-section scroll-reveal">
        <ResearchGlobe client:visible />
      </div>
    </div>

    <WaveDivider id="sites-wave" fillColor="surface" />
  </section>

  <!-- Collaborators CTA -->
  <section class="section bg-surface">
    <div class="container">
      <div class="collab-cta scroll-reveal">
        <div class="collab-cta-content">
          <span class="eyebrow text-accent">Partner With Us</span>
          <h2 class="mb-5">Interested in Collaborating?</h2>
          <p class="text-muted text-lg mb-8 max-w-lg">
            We work with researchers, conservation organizations, and communities worldwide.
            If you're interested in partnering on research or applying our findings, we'd love to hear from you.
          </p>
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="mailto:astier@ucsb.edu" class="btn btn-primary magnetic-btn group">
              <span>Get in Touch</span>
              <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
            <a href="/publications" class="btn btn-secondary magnetic-btn">
              View Publications
            </a>
          </div>
        </div>
        <div class="collab-cta-image">
          <img
            src="/images/research-team-boats-turquoise-lagoon.webp"
            alt="Research team in the field"
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* ========================================
     Floating Bubbles
     ======================================== */
  .floating-bubbles {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 1;
  }

  .bubble {
    @apply absolute rounded-full;
    background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.3), rgba(45, 212, 191, 0.1));
    animation: float-up linear infinite;
    opacity: 0;
  }

  .bubble-1 { width: 20px; height: 20px; left: 10%; animation-duration: 12s; animation-delay: 0s; }
  .bubble-2 { width: 35px; height: 35px; left: 25%; animation-duration: 15s; animation-delay: 2s; }
  .bubble-3 { width: 15px; height: 15px; left: 40%; animation-duration: 10s; animation-delay: 4s; }
  .bubble-4 { width: 25px; height: 25px; left: 55%; animation-duration: 14s; animation-delay: 1s; }
  .bubble-5 { width: 40px; height: 40px; left: 70%; animation-duration: 16s; animation-delay: 3s; }
  .bubble-6 { width: 18px; height: 18px; left: 85%; animation-duration: 11s; animation-delay: 5s; }
  .bubble-7 { width: 30px; height: 30px; left: 15%; animation-duration: 13s; animation-delay: 6s; }
  .bubble-8 { width: 22px; height: 22px; left: 60%; animation-duration: 17s; animation-delay: 7s; }

  @keyframes float-up {
    0% {
      transform: translateY(100vh) scale(0.5);
      opacity: 0;
    }
    10% {
      opacity: 0.6;
    }
    90% {
      opacity: 0.6;
    }
    100% {
      transform: translateY(-100px) scale(1);
      opacity: 0;
    }
  }

  /* ========================================
     Animated Blob Shapes
     ======================================== */
  .blob-container {
    @apply absolute inset-0 overflow-hidden pointer-events-none;
    z-index: 0;
  }

  .blob {
    @apply absolute rounded-full;
    filter: blur(80px);
    animation: blob-morph 20s ease-in-out infinite;
  }

  .blob-1 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(56, 189, 248, 0.15) 0%, transparent 70%);
    top: -100px;
    right: -100px;
    animation-delay: 0s;
  }

  .blob-2 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(45, 212, 191, 0.12) 0%, transparent 70%);
    bottom: -50px;
    left: -100px;
    animation-delay: -10s;
  }

  @keyframes blob-morph {
    0%, 100% {
      transform: translate(0, 0) scale(1) rotate(0deg);
      border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
    }
    25% {
      transform: translate(30px, -50px) scale(1.1) rotate(90deg);
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    }
    50% {
      transform: translate(-20px, 20px) scale(0.95) rotate(180deg);
      border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
    }
    75% {
      transform: translate(20px, 40px) scale(1.05) rotate(270deg);
      border-radius: 50% 40% 50% 60% / 40% 60% 50% 40%;
    }
  }

  /* ========================================
     Hero Section
     ======================================== */
  .hero-section {
    @apply relative;
  }

  .parallax-bg {
    transform: translateZ(0);
    will-change: transform;
  }

  .hero-badge {
    animation: fadeDown 0.6s ease-out 0.1s forwards;
    opacity: 0;
  }

  .hero-title {
    animation: fadeUp 0.8s ease-out 0.2s forwards;
    opacity: 0;
  }

  .gradient-text {
    background: linear-gradient(135deg, #ffffff 0%, #38bdf8 40%, #2dd4bf 80%, #38bdf8 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 8s ease-in-out infinite;
  }

  @keyframes gradient-shift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  .hero-description {
    opacity: 1;
  }

  .text-reveal-word {
    display: inline-block;
    opacity: 0;
    transform: translateY(20px) rotateX(-90deg);
    animation: word-reveal 0.5s ease forwards;
    transform-origin: bottom;
  }

  .highlight-word {
    color: #38bdf8;
    font-weight: 600;
  }

  /* Stagger the word animations */
  .text-reveal-word:nth-child(1) { animation-delay: 0.4s; }
  .text-reveal-word:nth-child(2) { animation-delay: 0.45s; }
  .text-reveal-word:nth-child(3) { animation-delay: 0.5s; }
  .text-reveal-word:nth-child(4) { animation-delay: 0.55s; }
  .text-reveal-word:nth-child(5) { animation-delay: 0.6s; }
  .text-reveal-word:nth-child(6) { animation-delay: 0.65s; }
  .text-reveal-word:nth-child(7) { animation-delay: 0.7s; }
  .text-reveal-word:nth-child(8) { animation-delay: 0.75s; }
  .text-reveal-word:nth-child(9) { animation-delay: 0.8s; }
  .text-reveal-word:nth-child(10) { animation-delay: 0.85s; }
  .text-reveal-word:nth-child(11) { animation-delay: 0.9s; }
  .text-reveal-word:nth-child(12) { animation-delay: 0.95s; }
  .text-reveal-word:nth-child(13) { animation-delay: 1.0s; }
  .text-reveal-word:nth-child(14) { animation-delay: 1.05s; }
  .text-reveal-word:nth-child(15) { animation-delay: 1.1s; }
  .text-reveal-word:nth-child(16) { animation-delay: 1.15s; }
  .text-reveal-word:nth-child(17) { animation-delay: 1.2s; }
  .text-reveal-word:nth-child(18) { animation-delay: 1.25s; }
  .text-reveal-word:nth-child(19) { animation-delay: 1.3s; }
  .text-reveal-word:nth-child(20) { animation-delay: 1.35s; }
  .text-reveal-word:nth-child(21) { animation-delay: 1.4s; }
  .text-reveal-word:nth-child(22) { animation-delay: 1.45s; }
  .text-reveal-word:nth-child(23) { animation-delay: 1.5s; }
  .text-reveal-word:nth-child(24) { animation-delay: 1.55s; }
  .text-reveal-word:nth-child(25) { animation-delay: 1.6s; }
  .text-reveal-word:nth-child(26) { animation-delay: 1.65s; }
  .text-reveal-word:nth-child(27) { animation-delay: 1.7s; }
  .text-reveal-word:nth-child(28) { animation-delay: 1.75s; }
  .text-reveal-word:nth-child(29) { animation-delay: 1.8s; }
  .text-reveal-word:nth-child(30) { animation-delay: 1.85s; }
  .text-reveal-word:nth-child(31) { animation-delay: 1.9s; }
  .text-reveal-word:nth-child(32) { animation-delay: 1.95s; }
  .text-reveal-word:nth-child(33) { animation-delay: 2.0s; }

  @keyframes word-reveal {
    to {
      opacity: 1;
      transform: translateY(0) rotateX(0);
    }
  }

  .jump-nav {
    animation: fadeUp 0.8s ease-out 0.6s forwards;
    opacity: 0;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(24px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-fade-down {
    animation: fadeDown 0.6s ease-out forwards;
  }

  /* Jump Navigation */
  .jump-link {
    @apply inline-flex items-center gap-2 px-5 py-2.5 rounded-full text-sm font-semibold;
    @apply bg-white/[0.08] text-white/80 border border-white/15;
    @apply transition-all duration-300 no-underline;
    @apply hover:bg-white/15 hover:text-white hover:border-white/30;
  }

  .jump-link.active {
    @apply bg-accent/20 text-accent border-accent/40;
  }

  /* ========================================
     Section Spacing
     ======================================== */
  .section-lg {
    @apply py-20 md:py-28 pb-28 md:pb-36;
  }

  /* ========================================
     Research Pillars
     ======================================== */
  .pillars-grid {
    @apply grid md:grid-cols-3 gap-6 lg:gap-8 max-w-6xl mx-auto;
  }

  .pillar-card {
    @apply relative p-7 lg:p-8 rounded-2xl text-left;
    @apply border border-line/50;
    @apply transition-all duration-300 ease-out;
    background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  .pillar-card::before {
    content: '';
    @apply absolute inset-0 rounded-2xl opacity-0;
    background: linear-gradient(135deg, rgba(56, 189, 248, 0.1) 0%, rgba(45, 212, 191, 0.05) 100%);
    transition: opacity 0.3s ease;
    z-index: -1;
  }

  .pillar-card:hover {
    @apply -translate-y-2;
    border-color: rgba(56, 189, 248, 0.4);
    box-shadow:
      0 25px 50px -12px rgba(0, 0, 0, 0.4),
      0 0 40px rgba(56, 189, 248, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .pillar-card:hover::before {
    opacity: 1;
  }

  .pillar-number {
    @apply absolute top-6 right-6 text-4xl font-black;
    background: linear-gradient(135deg, rgba(56, 189, 248, 0.3) 0%, rgba(45, 212, 191, 0.2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    transition: all 0.3s ease;
  }

  .pillar-card:hover .pillar-number {
    background: linear-gradient(135deg, rgba(56, 189, 248, 0.6) 0%, rgba(45, 212, 191, 0.5) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    transform: scale(1.1);
  }

  .counter-number.counting {
    animation: counter-pop 0.3s ease;
  }

  @keyframes counter-pop {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  .pillar-icon {
    @apply w-14 h-14 mb-5 rounded-xl;
    @apply flex items-center justify-center;
    @apply transition-all duration-500;
    position: relative;
  }

  .pillar-icon::before {
    content: '';
    @apply absolute inset-0 rounded-xl;
    background: inherit;
    filter: blur(10px);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
  }

  .pillar-card:hover .pillar-icon {
    @apply scale-110;
    animation: icon-bounce 0.6s ease;
  }

  .pillar-card:hover .pillar-icon::before {
    opacity: 0.5;
  }

  .pillar-card:hover .pillar-icon svg {
    animation: icon-spin 0.8s ease;
  }

  @keyframes icon-bounce {
    0%, 100% { transform: scale(1.1) translateY(0); }
    50% { transform: scale(1.15) translateY(-4px); }
  }

  @keyframes icon-spin {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(-10deg); }
    75% { transform: rotate(10deg); }
    100% { transform: rotate(0deg); }
  }

  .pillar-icon-1 { @apply bg-accent/20 text-accent; }
  .pillar-icon-2 { @apply bg-accent-2/20 text-accent-2; }
  .pillar-icon-3 { @apply bg-accent-warm/20 text-accent-warm; }

  /* ========================================
     Animated Equation Accent (Quantitative Models)
     ======================================== */
  .equation-accent {
    @apply absolute -top-4 -right-4 md:-top-6 md:-right-6;
    @apply font-mono text-xs md:text-sm;
    @apply text-accent-warm/40;
    @apply pointer-events-none select-none;
    font-style: italic;
    transform: rotate(8deg);
    z-index: 0;
  }

  .eq-term {
    @apply inline-block;
    opacity: 0;
    animation: eq-fade-in 0.4s ease-out forwards;
  }

  .eq-1 { animation-delay: 0.1s; }
  .eq-2 { animation-delay: 0.2s; }
  .eq-3 { animation-delay: 0.3s; }
  .eq-4 { animation-delay: 0.4s; }
  .eq-5 { animation-delay: 0.5s; }
  .eq-6 { animation-delay: 0.6s; }
  .eq-7 { animation-delay: 0.7s; }

  @keyframes eq-fade-in {
    0% {
      opacity: 0;
      transform: translateY(8px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Shimmer effect on hover */
  .pillar-card:nth-child(3):hover .equation-accent {
    animation: eq-shimmer 2s ease-in-out infinite;
  }

  .pillar-card:nth-child(3):hover .eq-term {
    animation: eq-glow 0.8s ease-out forwards;
  }

  @keyframes eq-shimmer {
    0%, 100% {
      filter: brightness(1);
      transform: rotate(8deg) translateX(0);
    }
    50% {
      filter: brightness(1.4);
      transform: rotate(8deg) translateX(2px);
    }
  }

  @keyframes eq-glow {
    0% {
      opacity: 0.4;
      text-shadow: none;
    }
    100% {
      opacity: 0.8;
      text-shadow: 0 0 8px rgba(251, 146, 60, 0.5);
    }
  }

  .pillar-title {
    @apply text-xl font-bold text-ink mb-3;
  }

  .pillar-desc {
    @apply text-muted text-sm leading-relaxed mb-5;
  }

  .pillar-topics {
    @apply space-y-2.5 border-t border-line/50 pt-5;
  }

  .pillar-topics li {
    @apply flex items-start gap-2.5 text-muted text-sm;
  }

  /* ========================================
     Pipeline Diagram
     ======================================== */
  .pipeline-diagram {
    @apply relative max-w-5xl mx-auto;
  }

  .pipeline-svg {
    @apply w-full h-auto;
    max-height: 340px;
  }

  .connection-path {
    fill: none;
    stroke: url(#lineGradient1);
    stroke-width: 3;
    stroke-linecap: round;
    stroke-dasharray: 8 4;
    animation: dash-flow 20s linear infinite;
  }

  @keyframes dash-flow {
    to { stroke-dashoffset: -100; }
  }

  .node-glow {
    fill: rgba(56, 189, 248, 0.1);
    animation: node-pulse 3s ease-in-out infinite;
  }

  @keyframes node-pulse {
    0%, 100% { opacity: 0.3; r: 50; }
    50% { opacity: 0.6; r: 54; }
  }

  .node-ring {
    fill: none;
    stroke: rgba(56, 189, 248, 0.3);
    stroke-width: 2;
  }

  .node-core {
    fill: #38bdf8;
    transition: fill 0.3s ease;
  }

  .node:hover .node-core {
    fill: #2dd4bf;
  }

  .node {
    cursor: pointer;
  }

  .node:hover {
    transform: scale(1.05);
    transform-origin: center;
  }

  .node-number {
    font-family: Inter, system-ui, sans-serif;
    pointer-events: none;
  }

  .label-title {
    fill: white;
    font-family: Inter, system-ui, sans-serif;
    font-size: 18px;
    font-weight: 700;
  }

  .label-desc {
    fill: rgba(255, 255, 255, 0.5);
    font-family: Inter, system-ui, sans-serif;
    font-size: 13px;
  }

  .particle {
    fill: #2dd4bf;
    filter: url(#glow);
  }

  /* Mobile Pipeline */
  .pipeline-mobile {
    @apply max-w-md mx-auto;
  }

  .mobile-step {
    @apply flex items-start gap-5 p-5 rounded-2xl;
    @apply bg-white/[0.03] border border-white/10;
  }

  .mobile-node {
    @apply w-12 h-12 rounded-xl flex-shrink-0;
    @apply bg-accent flex items-center justify-center;
    @apply shadow-lg shadow-accent/20;
  }

  .mobile-node-number {
    @apply text-white font-black text-lg;
  }

  .mobile-content h4 {
    @apply text-white font-bold text-base mb-1;
  }

  .mobile-content p {
    @apply text-white/50 text-sm leading-relaxed;
  }

  .mobile-connector {
    @apply h-10 flex items-center justify-center relative ml-6;
  }

  .mobile-line {
    @apply absolute left-0 top-0 bottom-0 w-0.5;
    @apply bg-gradient-to-b from-accent/30 to-accent-2/30;
  }

  .mobile-particle {
    @apply w-2 h-2 rounded-full bg-accent-2;
    animation: flow-down 2s ease-in-out infinite;
    box-shadow: 0 0 8px #2dd4bf;
  }

  @keyframes flow-down {
    0% { transform: translateY(-16px); opacity: 0; }
    20% { opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateY(16px); opacity: 0; }
  }

  /* ========================================
     Study Systems
     ======================================== */
  .systems-grid {
    @apply grid lg:grid-cols-2 gap-8 max-w-5xl mx-auto;
  }

  .system-card {
    @apply relative rounded-2xl overflow-hidden no-underline block;
    @apply border border-line/50;
    @apply transition-all duration-500 ease-out;
    aspect-ratio: 16 / 10;
  }

  .system-card:hover {
    @apply -translate-y-2 shadow-2xl;
    border-color: rgba(56, 189, 248, 0.3);
  }

  .system-card-image {
    @apply absolute inset-0;
  }

  .system-card-image img {
    @apply w-full h-full object-cover;
    @apply transition-all duration-700 ease-out;
    transform: scale(1.05);
  }

  .system-card:hover .system-card-image img {
    transform: scale(1.15);
  }

  /* Parallax tilt effect on system cards */
  .system-card {
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .system-card .system-card-content {
    transform: translateZ(30px);
  }

  .system-card-overlay {
    @apply absolute inset-0;
    background: linear-gradient(
      to top,
      rgba(11, 37, 69, 0.95) 0%,
      rgba(11, 37, 69, 0.6) 40%,
      rgba(11, 37, 69, 0.2) 70%,
      transparent 100%
    );
  }

  .system-card-content {
    @apply absolute bottom-0 left-0 right-0 p-6 md:p-8;
  }

  .system-badge {
    @apply inline-flex items-center gap-1.5 text-accent-2 text-xs font-bold uppercase tracking-wider mb-3;
  }

  .system-title {
    @apply text-2xl md:text-3xl font-black text-white mb-3;
    @apply transition-colors duration-300;
  }

  .system-card:hover .system-title {
    @apply text-accent;
  }

  .system-tagline {
    @apply text-white/60 text-sm leading-relaxed mb-4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .system-link {
    @apply inline-flex items-center gap-2 text-accent text-sm font-bold;
    @apply transition-all duration-300;
  }

  .system-card:hover .system-link {
    @apply gap-3;
  }

  /* ========================================
     Field Sites
     ======================================== */
  .sites-grid {
    @apply grid md:grid-cols-2 gap-8 max-w-5xl mx-auto;
  }

  .site-card {
    @apply rounded-2xl overflow-hidden;
    @apply bg-white/[0.03] border border-white/10;
    @apply transition-all duration-300;
  }

  .site-card:hover {
    @apply -translate-y-2 shadow-xl;
    border-color: rgba(56, 189, 248, 0.3);
  }

  .site-image-wrapper {
    @apply relative aspect-video overflow-hidden;
  }

  .site-image {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500;
  }

  .site-card:hover .site-image {
    @apply scale-105;
  }

  .site-image-overlay {
    @apply absolute inset-0;
    background: linear-gradient(to top, rgba(11, 37, 69, 0.6) 0%, transparent 50%);
  }

  .site-tag {
    @apply absolute bottom-3 left-3;
    @apply px-3 py-1.5 rounded-full;
    @apply bg-accent/90 text-white text-xs font-bold;
  }

  .site-content {
    @apply p-6;
  }

  .site-title {
    @apply text-xl font-bold text-white mb-3;
    @apply transition-colors duration-200;
  }

  .site-card:hover .site-title {
    @apply text-accent;
  }

  .site-desc {
    @apply text-white/50 text-sm leading-relaxed mb-4;
  }

  .site-features {
    @apply space-y-2;
  }

  .site-features li {
    @apply flex items-center gap-2 text-white/70 text-sm;
  }

  /* ========================================
     Collaboration CTA
     ======================================== */
  .collab-cta {
    @apply flex flex-col lg:flex-row gap-10 lg:gap-16 items-center;
    @apply p-8 md:p-12 lg:p-16 rounded-3xl;
    @apply bg-gradient-to-br from-accent/10 via-accent/5 to-accent-2/10;
    @apply border border-accent/20;
    @apply relative overflow-hidden;
  }

  .collab-cta::before {
    content: '';
    @apply absolute inset-0 opacity-30;
    background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.15), transparent 50%),
                radial-gradient(circle at bottom left, rgba(45, 212, 191, 0.15), transparent 50%);
  }

  .collab-cta-content {
    @apply relative z-10 flex-1;
  }

  .collab-cta-image {
    @apply relative z-10 w-full lg:w-2/5 aspect-video rounded-2xl overflow-hidden;
    @apply border border-white/10;
  }

  .collab-cta-image img {
    @apply w-full h-full object-cover;
    @apply transition-transform duration-500;
  }

  .collab-cta:hover .collab-cta-image img {
    @apply scale-105;
  }

  /* ========================================
     Reduced Motion
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .hero-badge,
    .hero-title,
    .jump-nav,
    .gradient-text,
    .text-reveal-word {
      animation: none;
      opacity: 1;
      transform: none;
    }

    .connection-path,
    .node-glow,
    .mobile-particle,
    .bubble,
    .blob,
    .scroll-progress-bar,
    .eq-term,
    .equation-accent {
      animation: none;
    }

    .eq-term {
      opacity: 1;
    }

    .system-card-image img,
    .site-image,
    .collab-cta-image img {
      transition: none;
    }

    .pillar-card,
    .system-card,
    .site-card,
    .magnetic-btn {
      transition: none;
    }

    .custom-cursor,
    .custom-cursor-dot {
      display: none !important;
    }

    .pillar-icon,
    .pillar-icon svg {
      animation: none;
    }
  }
</style>

<script>
  // Parallax effect for hero
  const initParallax = () => {
    const parallaxBg = document.querySelector('.parallax-bg') as HTMLElement;
    if (!parallaxBg) return;

    let ticking = false;

    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          const scrolled = window.scrollY;
          const rate = scrolled * 0.3;
          parallaxBg.style.transform = `translateY(${rate}px)`;
          ticking = false;
        });
        ticking = true;
      }
    };

    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      window.addEventListener('scroll', handleScroll, { passive: true });
    }
  };

  // Active section indicator for jump navigation
  const initJumpNavHighlight = () => {
    const sections = document.querySelectorAll('section[id]');
    const jumpLinks = document.querySelectorAll('.jump-link[data-section]');

    if (sections.length === 0 || jumpLinks.length === 0) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.id;

          jumpLinks.forEach((link) => {
            const linkSection = link.getAttribute('data-section');
            if (linkSection === sectionId) {
              link.classList.add('active');
            } else {
              link.classList.remove('active');
            }
          });
        }
      });
    }, {
      rootMargin: '-20% 0px -60% 0px',
      threshold: 0
    });

    sections.forEach((section) => {
      if (section.id) observer.observe(section);
    });

    return () => observer.disconnect();
  };

  // Particle Animation for Pipeline Diagram
  const initPipelineAnimation = () => {
    const svg = document.querySelector('.pipeline-svg');
    const particlesContainer = document.getElementById('particles');

    if (!svg || !particlesContainer) return;

    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    const path1 = document.getElementById('path1') as SVGPathElement | null;
    const path2 = document.getElementById('path2') as SVGPathElement | null;
    const path3 = document.getElementById('path3') as SVGPathElement | null;

    if (!path1 || !path2 || !path3) return;

    const paths: SVGPathElement[] = [path1, path2, path3];

    const particleCount = 2;
    const colors = ['#38bdf8', '#2dd4bf'];

    paths.forEach((_, pathIndex) => {
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        particle.setAttribute('r', '4');
        particle.setAttribute('class', 'particle');
        particle.style.fill = colors[i % colors.length];
        particle.dataset.pathIndex = pathIndex.toString();
        particle.dataset.offset = (i / particleCount).toString();
        particle.dataset.speed = (0.0006 + Math.random() * 0.0003).toString();
        particlesContainer.appendChild(particle);
      }
    });

    let animationId: number;
    let startTime: number;

    const animate = (timestamp: number) => {
      if (!startTime) startTime = timestamp;
      const elapsed = timestamp - startTime;

      const particles = particlesContainer.querySelectorAll('.particle') as NodeListOf<SVGCircleElement>;

      particles.forEach((particle) => {
        const pathIndex = parseInt(particle.dataset.pathIndex || '0');
        const offset = parseFloat(particle.dataset.offset || '0');
        const speed = parseFloat(particle.dataset.speed || '0.001');
        const path = paths[pathIndex];

        if (!path) return;

        const pathLength = path.getTotalLength();
        const progress = ((elapsed * speed) + offset) % 1;
        const point = path.getPointAtLength(progress * pathLength);

        particle.setAttribute('cx', point.x.toString());
        particle.setAttribute('cy', point.y.toString());

        let opacity = 1;
        if (progress < 0.15) opacity = progress / 0.15;
        else if (progress > 0.85) opacity = (1 - progress) / 0.15;
        particle.style.opacity = opacity.toString();
      });

      animationId = requestAnimationFrame(animate);
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          startTime = 0;
          animationId = requestAnimationFrame(animate);
        } else {
          cancelAnimationFrame(animationId);
        }
      });
    }, { threshold: 0.2 });

    const diagram = document.getElementById('pipeline-diagram');
    if (diagram) observer.observe(diagram);

    return () => {
      cancelAnimationFrame(animationId);
      observer.disconnect();
    };
  };

  // Counter Animation for Pillar Numbers
  const initCounterAnimation = () => {
    const counters = document.querySelectorAll('.counter-number');
    if (counters.length === 0) return;

    const animateCounter = (el: Element) => {
      const target = parseInt(el.getAttribute('data-target') || '0');
      let current = 0;
      const duration = 1000;
      const startTime = performance.now();

      const update = (currentTime: number) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // Easing function
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        current = Math.round(easeOutQuart * target);

        el.textContent = String(current).padStart(2, '0');

        if (progress < 1) {
          requestAnimationFrame(update);
        } else {
          el.classList.add('counting');
          setTimeout(() => el.classList.remove('counting'), 300);
        }
      };

      requestAnimationFrame(update);
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          animateCounter(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    counters.forEach((counter) => observer.observe(counter));
  };

  // System Card Tilt Effect
  const initCardTilt = () => {
    const cards = document.querySelectorAll('.system-card');

    cards.forEach((card) => {
      card.addEventListener('mousemove', (e) => {
        const event = e as MouseEvent;
        const rect = (card as HTMLElement).getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        const rotateX = (y - centerY) / 20;
        const rotateY = (centerX - x) / 20;

        (card as HTMLElement).style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-8px)`;
      });

      card.addEventListener('mouseleave', () => {
        (card as HTMLElement).style.transform = '';
      });
    });
  };

  // Initialize all
  initParallax();
  initJumpNavHighlight();
  initPipelineAnimation();
  initCounterAnimation();
  initCardTilt();

  // Re-init after view transitions
  document.addEventListener('astro:after-swap', () => {
    initParallax();
    initJumpNavHighlight();
    initPipelineAnimation();
    initCounterAnimation();
    initCardTilt();
  });
</script>
